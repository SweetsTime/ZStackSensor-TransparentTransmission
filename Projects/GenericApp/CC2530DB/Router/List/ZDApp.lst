###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.60.1.40026 for 8051             08/Jun/2018  08:44:42 #
# Copyright (C) 2004-2010 IAR Systems AB.                                     #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\win7\Desktop\ZStack传感器透明传输源程序V2 #
#                          .45-13(带回码2018-5-20)\Components\stack\zdo\ZDApp #
#                          .c                                                 #
#    Command line       =  -f "C:\Users\win7\Desktop\ZStack传感器透明传输源程 #
#                          序V2.45-13(带回码2018-5-20)\Projects\GenericApp\CC #
#                          2530DB\..\..\..\COMPONENTS\Tools\CC2530DB\f8wRoute #
#                          r.cfg" (-DCPU32MHZ -DROOT=__near_func              #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\Tools\CC2530DB\f8wConfig.c #
#                          fg" (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR  #
#                          -DNWK_START_DELAY=1000 -DEXTENDED_JOINING_RANDOM_M #
#                          ASK=0x007F -DBEACON_REQUEST_DELAY=1000             #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Users\win7\Desktop\ZSta #
#                          ck传感器透明传输源程序V2.45-13(带回码2018-5-20)\Co #
#                          mponents\stack\zdo\ZDApp.c" -D ZTOOL_P1 -D         #
#                          MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D           #
#                          xNV_RESTORE -D SERIAL_SUPPORTED=DEBUG -D           #
#                          SENSOR_TYPE=0X31 -D CHANLIST_C_R_E=25 -D           #
#                          ZDAPP_CONFIG_PAN_ID=0x0004 -D                      #
#                          ZigBee_C_R_E_Engineering -D ZigBee_C_R_E_IEEE -D   #
#                          xSENSOR_TYPE_R_E=0X01 -lC                          #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\Router\List\" -lA "C:\Users\win7\Desktop\ZStac #
#                          k传感器透明传输源程序V2.45-13(带回码2018-5-20)\Pro #
#                          jects\GenericApp\CC2530DB\Router\List\"            #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\Router\Obj\" -e --require_prototypes --debug   #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Users\win7\Desktop\ZSt #
#                          ack传感器透明传输源程序V2.45-13(带回码2018-5-20)\P #
#                          rojects\GenericApp\CC2530DB\" -I                   #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\SOURCE\" -I "C:\Users\win7\Desktop\ZStack传 #
#                          感器透明传输源程序V2.45-13(带回码2018-5-20)\Projec #
#                          ts\GenericApp\CC2530DB\..\..\..\COMPONENTS\ZMAIN\T #
#                          I2530DB\" -I "C:\Users\win7\Desktop\ZStack传感器透 #
#                          明传输源程序V2.45-13(带回码2018-5-20)\Projects\Gen #
#                          ericApp\CC2530DB\..\..\..\COMPONENTS\MT\" -I       #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\HAL\INCLUDE\" -I           #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\" -I   #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\" -I        #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\OSAL\INCLUDE\" -I          #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\STACK\AF\" -I              #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\STACK\NWK\" -I             #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\STACK\SEC\" -I             #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\STACK\SAPI\" -I            #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\STACK\SYS\" -I             #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\STACK\ZDO\" -I             #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\ZMAC\F8W\" -I              #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\ZMAC\" -I                  #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\SERVICES\SADDR\" -I        #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\SERVICES\SDATA\" -I        #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\MAC\INCLUDE\" -I           #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\" -I        #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\" -I   #
#                          "C:\Users\win7\Desktop\ZStack传感器透明传输源程序V #
#                          2.45-13(带回码2018-5-20)\Projects\GenericApp\CC253 #
#                          0DB\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE #
#                          _CHIP\" -I "C:\Program Files (x86)\IAR             #
#                          Systems\Embedded Workbench 5.4\8051\INC\" -I       #
#                          "C:\Program Files (x86)\IAR Systems\Embedded       #
#                          Workbench 5.4\8051\INC\CLIB\" -Ohz                 #
#    List file          =  C:\Users\win7\Desktop\ZStack传感器透明传输源程序V2 #
#                          .45-13(带回码2018-5-20)\Projects\GenericApp\CC2530 #
#                          DB\Router\List\ZDApp.lst                           #
#    Object file        =  C:\Users\win7\Desktop\ZStack传感器透明传输源程序V2 #
#                          .45-13(带回码2018-5-20)\Projects\GenericApp\CC2530 #
#                          DB\Router\Obj\ZDApp.r51                            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\win7\Desktop\ZStack传感器透明传输源程序V2.45-13(带回码2018-5-20)\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2010-08-20 15:30:00 -0700 (Fri, 20 Aug 2010) $
      4            Revision:       $Revision: 23463 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the user can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "ZMac.h"
     47          #include "OSAL.h"
     48          #include "OSAL_Tasks.h"
     49          #include "OSAL_PwrMgr.h"
     50          #include "OSAL_Nv.h"
     51          #include "AF.h"
     52          #include "APSMEDE.h"
     53          #include "NLMEDE.h"
     54          #include "AddrMgr.h"
     55          #include "ZDProfile.h"
     56          #include "ZDObject.h"
     57          #include "ZDConfig.h"
     58          #include "ZDSecMgr.h"
     59          #include "ZDApp.h"
     60          #include "DebugTrace.h"
     61          #include "nwk_util.h"
     62          #include "OnBoard.h"
     63          #include "ZGlobals.h"
     64          #include "ZDNwkMgr.h"
     65          #include "GenericApp.h"
     66          #include "rtg.h"
     67          #include "appr51.h"
     68          
     69          #include "ssp.h"
     70          
     71          /* HAL */
     72          #include "hal_led.h"
     73          #include "hal_lcd.h"
     74          #include "hal_key.h"
     75          
     76          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     77            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     78          #endif
     79          
     80          /*********************************************************************
     81           * CONSTANTS
     82           */
     83          
     84          #if !defined( NWK_START_DELAY )
     85            #define NWK_START_DELAY             100   // in milliseconds
     86          #endif
     87          
     88          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     89            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     90          #endif
     91          
     92          #if !defined( BEACON_REQUEST_DELAY )
     93            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     94          #endif
     95          
     96          #if !defined( BEACON_REQ_DELAY_MASK )
     97            #define BEACON_REQ_DELAY_MASK       0x007F
     98          #endif
     99          
    100          #define MAX_RESUME_RETRY            3
    101          
    102          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    103          
    104          // Beacon Order Settings (see NLMEDE.h)
    105          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    106          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    107          
    108          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    109            // The number of times the frame counter can change before
    110            // saving to NV
    111            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    112          #endif
    113          
    114          // Leave control bits
    115          #define ZDAPP_LEAVE_CTRL_INIT 0
    116          #define ZDAPP_LEAVE_CTRL_SET  1
    117          #define ZDAPP_LEAVE_CTRL_RA   2
    118          
    119          // Address Manager Stub Implementation
    120          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    121          
    122          
    123          #if !defined ZDO_NV_SAVE_RFDs
    124          #define ZDO_NV_SAVE_RFDs  TRUE
    125          #endif
    126          
    127          // Delay time before updating NWK NV data to force fewer writes during high activity.
    128          #if ZDO_NV_SAVE_RFDs
    129          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    130          #else
    131          #define ZDAPP_UPDATE_NWK_NV_TIME 65000
    132          #endif
    133          
    134          /*********************************************************************
    135           * GLOBAL VARIABLES
    136           */
    137          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    138          uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    139          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    140          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    141          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    143          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    151          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    152          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    154          
    155          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    157          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    159          
    160          /*********************************************************************
    161           * EXTERNAL VARIABLES
    162           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    163          uint8 ZDAppNumber=0;
   \                     ZDAppNumber:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    164          /*********************************************************************
    165           * EXTERNAL FUNCTIONS
    166           */
    167          
    168          /*********************************************************************
    169           * LOCAL FUNCTIONS
    170           */
    171          
    172          void ZDApp_NetworkStartEvt( void );
    173          void ZDApp_DeviceAuthEvt( void );
    174          void ZDApp_SaveNetworkStateEvt( void );
    175          
    176          uint8 ZDApp_ReadNetworkRestoreState( void );
    177          uint8 ZDApp_RestoreNetworkState( void );
    178          void ZDAppDetermineDeviceType( void );
    179          void ZDApp_InitUserDesc( void );
    180          void ZDAppCheckForHoldKey( void );
    181          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    182          void ZDApp_ProcessNetworkJoin( void );
    183          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    184          void ZDApp_SaveNwkKey( void );
    185          uint8 ZDApp_RestoreNwkKey( void );
    186          
    187          void ZDApp_SecInit( uint8 state );
    188          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    189          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    190          
    191          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    192          
    193          void ZDApp_ResetTimerStart( uint16 delay );
    194          void ZDApp_ResetTimerCancel( void );
    195          void ZDApp_LeaveCtrlInit( void );
    196          void ZDApp_LeaveCtrlSet( uint8 ra );
    197          uint8 ZDApp_LeaveCtrlBypass( void );
    198          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    199          void ZDApp_LeaveReset( uint8 ra );
    200          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    201                                  uint8 removeChildren );
    202          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    203          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    204          void ZDApp_RegisterCBs( void );
    205          
    206          /*********************************************************************
    207           * LOCAL VARIABLES
    208           */
    209          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    210          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    211          uint16 EndDevicePANID;
   \                     EndDevicePANID:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    212          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    213          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    214          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    215          
    216          #if defined( HOLD_AUTO_START )
    217            devStates_t devState = DEV_HOLD;
    218          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    219            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    220          #endif
    221          
    222          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    223            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    224            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    225                                  // to parent. Set to make the device do an Orphan scan.
    226          #else
    227            // Set the default to coodinator
    228            devStartModes_t devStartMode = MODE_HARD;
    229          #endif
    230          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    231          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    232          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    233          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    234          {
    235            ZDO_EP,
    236            &ZDAppTaskID,
    237            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    238            (afNetworkLatencyReq_t)0            // No Network Latency req
    239          };
    240          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    241          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    242          
    243          /*********************************************************************
    244           * @fn      ZDApp_Init
    245           *
    246           * @brief   ZDApp Initialization function.
    247           *
    248           * @param   task_id - ZDApp Task ID
    249           *
    250           * @return  None
    251           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    252          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    253          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    254            // Save the task ID
    255            ZDAppTaskID = task_id;
   \   000006   90....       MOV     DPTR,#ZDAppTaskID
   \   000009   F0           MOVX    @DPTR,A
    256          
    257            // Initialize the ZDO global device short address storage
    258            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   00000F   F0           MOVX    @DPTR,A
    259            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000010   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000013   74FE         MOV     A,#-0x2
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   74FF         MOV     A,#-0x1
   \   000019   F0           MOVX    @DPTR,A
    260            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   00001A                ; Setup parameters for call to function NLME_GetExtAddr
   \   00001A   12....       LCALL   ??NLME_GetExtAddr?relay
    261          
    262            // Check for manual "Hold Auto Start"
    263            ZDAppCheckForHoldKey();
   \   00001D                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001D   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    264          
    265            // Initialize ZDO items and setup the device - type of device to create.
    266            ZDO_Init();
   \   000020                ; Setup parameters for call to function ZDO_Init
   \   000020   12....       LCALL   ??ZDO_Init?relay
    267          
    268            // Register the endpoint description with the AF
    269            // This task doesn't have a Simple description, but we still need
    270            // to register the endpoint.
    271            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000023                ; Setup parameters for call to function afRegister
   \   000023   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000025   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   000027   12....       LCALL   ??afRegister?relay
    272          
    273          #if defined( ZDO_USERDESC_RESPONSE )
    274            ZDApp_InitUserDesc();
   \   00002A                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   00002A   12....       LCALL   ??ZDApp_InitUserDesc?relay
    275          #endif // ZDO_USERDESC_RESPONSE
    276          
    277            // Start the device?
    278            if ( devState != DEV_HOLD )
   \   00002D   90....       MOV     DPTR,#devState
   \   000030   E0           MOVX    A,@DPTR
   \   000031   6009         JZ      ??ZDApp_Init_0
    279            {
    280              ZDOInitDevice( 0 );
   \   000033                ; Setup parameters for call to function ZDOInitDevice
   \   000033   7A00         MOV     R2,#0x0
   \   000035   7B00         MOV     R3,#0x0
   \   000037   12....       LCALL   ??ZDOInitDevice?relay
   \   00003A   800D         SJMP    ??ZDApp_Init_1
    281            }
    282            else
    283            {
    284              // Blink LED to indicate HOLD_START
    285              HalLedBlink ( HAL_LED_2, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00003C                ; Setup parameters for call to function HalLedBlink
   \   00003C   7CF4         MOV     R4,#-0xc
   \   00003E   7D01         MOV     R5,#0x1
   \   000040   7B32         MOV     R3,#0x32
   \   000042   7A00         MOV     R2,#0x0
   \   000044   7902         MOV     R1,#0x2
   \   000046   12....       LCALL   ??HalLedBlink?relay
    286            }
    287          
    288            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000049                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000049   12....       LCALL   ??ZDApp_RegisterCBs?relay
    289          } /* ZDApp_Init() */
   \   00004C   02....       LJMP    ??Subroutine33_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine33_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    290          
    291          /*********************************************************************
    292           * @fn          ZDApp_SecInit
    293           *
    294           * @brief       ZDApp initialize security.
    295           *
    296           * @param       state - device initialization state
    297           *
    298           * @return      none
    299           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    300          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    301          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    302            uint8 zgPreConfigKey[SEC_KEY_LEN];
    303          
    304            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    305            {
    306              // Set the Trust Center bit
    307              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    308            }
    309          
    310            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    311            {
    312              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    313            }
    314          
    315            // Initialize ZigBee Device Security Manager
    316            ZDSecMgrInit(state);
   \   000005                ; Setup parameters for call to function ZDSecMgrInit
   \   000005   12....       LCALL   ??ZDSecMgrInit?relay
    317          
    318            if ( ZG_SECURE_ENABLED )
    319            {
    320              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    321              {
    322                nwkFrameCounter = 0;
    323          
    324                if( _NIB.nwkKeyLoaded == FALSE )
    325                {
    326                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    327                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    328                  {
    329                      ZDSecMgrReadKeyFromNv(ZCD_NV_PRECFGKEY, zgPreConfigKey);
    330                      SSP_UpdateNwkKey( zgPreConfigKey, 0);
    331                      SSP_SwitchNwkKey( 0 );
    332          
    333                      // clear local copy of key
    334                      osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
    335                  }
    336                }
    337              }
    338            }
    339             /*****************************************************
    340            ******************************************************
    341            ******************************************************
    342            ******************************************************/
    343          #if (ZDO_COORDINATOR)
    344          #else
    345          
    346          #if !defined( NV_RESTORE )
    347            ZigBee_C_R_E_Engineering_A();
   \   000008                ; Setup parameters for call to function ZigBee_C_R_E_Engineering_A
   \   000008   12....       LCALL   ??ZigBee_C_R_E_Engineering_A?relay
    348              
    349          #endif   
    350          #endif 
    351          /*****************************************************
    352            ******************************************************
    353            ******************************************************
    354            ******************************************************/
    355          
    356          }
   \   00000B   02....       LJMP    ??Subroutine33_0 & 0xFFFF
    357          
    358          /*********************************************************************
    359           * @fn      ZDApp_event_loop()
    360           *
    361           * @brief   Main event loop for Zigbee device objects task. This function
    362           *          should be called at periodic intervals.
    363           *
    364           * @param   task_id - Task ID
    365           * @param   events  - Bitmap of events
    366           *
    367           * @return  none
    368           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    369          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    370          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    371            uint8 *msg_ptr;
    372            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   7049         JNZ     ??ZDApp_event_loop_1
    373            {
    374              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    375              {HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF );
    376                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    377          
    378                // Release the memory
    379                osal_msg_deallocate( msg_ptr );
    380          
    381          #if defined( SENSOR_TYPE_POWER )
    382          #if !defined( SENSOR_TYPE_POWER_ON )
    383               if(ZDAppNumber>50)
    384               {SLEEPCMD|=3;
    385               PCON|=1;
    386               }
    387          #endif      
    388          #endif      
    389              }
    390              // Return unprocessed events
    391              return (events ^ SYS_EVENT_MSG);
    392            }
    393          
    394            if ( events & ZDO_NETWORK_INIT )
   \   000013   EE           MOV     A,R6
   \   000014   A2E0         MOV     C,0xE0 /* A   */.0
   \   000016   505D         JNC     ??ZDApp_event_loop_2
    395            {HalLedSet ( HAL_LED_2, HAL_LED_MODE_ON );
   \   000018                ; Setup parameters for call to function HalLedSet
   \   000018   7A01         MOV     R2,#0x1
   \   00001A   7902         MOV     R1,#0x2
   \   00001C   12....       LCALL   ??HalLedSet?relay
    396             ZDAppNumber++;
   \   00001F   90....       MOV     DPTR,#ZDAppNumber
   \   000022   E0           MOVX    A,@DPTR
   \   000023   04           INC     A
   \   000024   F0           MOVX    @DPTR,A
    397          #if(SENSOR_TYPE =='Q') 
    398            PAN_ID_Success=0;
    399          #endif
    400          #if(ZDO_COORDINATOR==2)  //ZIGBEE  AT命令模式 透传模式
    401             PAN_ID_Success=0;
    402             HalUARTWrite(HAL_UART_PORT_0, "\r\n+CLOSED\r\n",11);
    403          #endif
    404              // Initialize apps and start the network
    405           
    406              devState = DEV_INIT;
   \   000025   7401         MOV     A,#0x1
   \   000027   90....       MOV     DPTR,#devState
   \   00002A   F0           MOVX    @DPTR,A
    407          
    408              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    409                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   00002B                ; Setup parameters for call to function ZDO_StartDevice
   \   00002B   7C0F         MOV     R4,#0xf
   \   00002D   7B0F         MOV     R3,#0xf
   \   00002F   90....       MOV     DPTR,#devStartMode
   \   000032   E0           MOVX    A,@DPTR
   \   000033   FA           MOV     R2,A
   \   000034   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000037   E0           MOVX    A,@DPTR
   \   000038   5407         ANL     A,#0x7
   \   00003A   F9           MOV     R1,A
   \   00003B   12....       LCALL   ??ZDO_StartDevice?relay
    410          
    411              // Return unprocessed events
    412              return (events ^ ZDO_NETWORK_INIT);
   \   00003E   7401         MOV     A,#0x1
   \                     ??ZDApp_event_loop_3:
   \   000040   6E           XRL     A,R6
   \   000041   FA           MOV     R2,A
   \   000042   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000043   FB           MOV     R3,A
   \   000044   02....       LJMP    ??ZDApp_event_loop_5 & 0xFFFF
    413            }
   \                     ??ZDApp_event_loop_6:
   \   000047                ; Setup parameters for call to function HalLedSet
   \   000047   7A00         MOV     R2,#0x0
   \   000049   7902         MOV     R1,#0x2
   \   00004B   12....       LCALL   ??HalLedSet?relay
   \   00004E                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00004E   AA..         MOV     R2,?V0 + 0
   \   000050   AB..         MOV     R3,?V0 + 1
   \   000052   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   000055                ; Setup parameters for call to function osal_msg_deallocate
   \   000055   AA..         MOV     R2,?V0 + 0
   \   000057   AB..         MOV     R3,?V0 + 1
   \   000059   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   00005C                ; Setup parameters for call to function osal_msg_receive
   \   00005C   90....       MOV     DPTR,#ZDAppTaskID
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F9           MOV     R1,A
   \   000061   12....       LCALL   ??osal_msg_receive?relay
   \   000064   8A..         MOV     ?V0 + 0,R2
   \   000066   8B..         MOV     ?V0 + 1,R3
   \   000068   EA           MOV     A,R2
   \   000069   7001         JNZ     ??ZDApp_event_loop_7
   \   00006B   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   00006C   70D9         JNZ     ??ZDApp_event_loop_6
   \   00006E   EE           MOV     A,R6
   \   00006F   FA           MOV     R2,A
   \   000070   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   000072   6F           XRL     A,R7
   \   000073   80CE         SJMP    ??ZDApp_event_loop_4
    414          
    415            if ( ZSTACK_ROUTER_BUILD )
    416            {
    417              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_2:
   \   000075   5402         ANL     A,#0x2
   \   000077   6007         JZ      ??ZDApp_event_loop_9
    418              {
    419                ZDApp_NetworkStartEvt();
   \   000079                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   000079   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    420          
    421                // Return unprocessed events
    422                return (events ^ ZDO_NETWORK_START);
   \   00007C   7402         MOV     A,#0x2
   \                     ??ZDApp_event_loop_10:
   \   00007E   80C0         SJMP    ??ZDApp_event_loop_3
    423              }
    424          
    425              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_9:
   \   000080   EE           MOV     A,R6
   \   000081   5420         ANL     A,#0x20
   \   000083   601D         JZ      ??ZDApp_event_loop_11
    426              {
    427                if ( nwkStatus == ZSuccess )
   \   000085   90....       MOV     DPTR,#nwkStatus
   \   000088   E0           MOVX    A,@DPTR
   \   000089   7010         JNZ     ??ZDApp_event_loop_12
    428                {   
    429                  if ( devState == DEV_END_DEVICE )
   \   00008B   90....       MOV     DPTR,#devState
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   6406         XRL     A,#0x6
   \   000091   7003         JNZ     ??ZDApp_event_loop_13
    430                    devState = DEV_ROUTER;
   \   000093   7407         MOV     A,#0x7
   \   000095   F0           MOVX    @DPTR,A
    431          
    432                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_13:
   \   000096                ; Setup parameters for call to function osal_pwrmgr_device
   \   000096   7900         MOV     R1,#0x0
   \   000098   12....       LCALL   ??osal_pwrmgr_device?relay
    433                }
    434                else
    435                {
    436                  // remain as end device!!
    437                }
    438                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_12:
   \   00009B                ; Setup parameters for call to function osal_set_event
   \   00009B   12....       LCALL   ?Subroutine13 & 0xFFFF
    439          
    440                // Return unprocessed events
    441                return (events ^ ZDO_ROUTER_START);
   \                     ??CrossCallReturnLabel_40:
   \   00009E   7420         MOV     A,#0x20
   \   0000A0   809E         SJMP    ??ZDApp_event_loop_3
    442              }
    443            }
    444          
    445            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_11:
   \   0000A2   EE           MOV     A,R6
   \   0000A3   5410         ANL     A,#0x10
   \   0000A5   6031         JZ      ??ZDApp_event_loop_14
    446            {HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF );
   \   0000A7                ; Setup parameters for call to function HalLedSet
   \   0000A7   7A00         MOV     R2,#0x0
   \   0000A9   7902         MOV     R1,#0x2
   \   0000AB   12....       LCALL   ??HalLedSet?relay
    447            ZDAppNumber=0;
   \   0000AE   E4           CLR     A
   \   0000AF   90....       MOV     DPTR,#ZDAppNumber
   \   0000B2   F0           MOVX    @DPTR,A
    448          #if(SENSOR_TYPE =='Q') 
    449            PAN_ID_Success=2;
    450          #endif
    451            
    452          #if(ZDO_COORDINATOR==2)  //ZIGBEE  AT命令模式 透传模式
    453             PAN_ID_Success=2;
    454            // HalUARTWrite(HAL_UART_PORT_0, "\r\n+CONNECT\r\n",12);
    455          #endif
    456              ZDO_UpdateNwkStatus( devState );
   \   0000B3                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   0000B3   90....       MOV     DPTR,#devState
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   F9           MOV     R1,A
   \   0000B8   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    457              // At start up, do one MTO route discovery if the device is a concentrator
    458             /*****************************************************
    459            ******************************************************
    460            ******************************************************
    461            ******************************************************/
    462          #if !defined( SENSOR_TYPE_R_E )
    463                ZigBee_C_R_E_Engineering_B();
   \   0000BB                ; Setup parameters for call to function ZigBee_C_R_E_Engineering_B
   \   0000BB   12....       LCALL   ??ZigBee_C_R_E_Engineering_B?relay
    464          #endif
    465            /*****************************************************
    466            ******************************************************
    467            ******************************************************
    468            ******************************************************/
    469                  
    470              if ( zgConcentratorEnable == TRUE )
   \   0000BE   90....       MOV     DPTR,#zgConcentratorEnable
   \   0000C1   E0           MOVX    A,@DPTR
   \   0000C2   6401         XRL     A,#0x1
   \   0000C4   700E         JNZ     ??CrossCallReturnLabel_58
    471              { 
    472                // Start next event
    473                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   0000C6                ; Setup parameters for call to function osal_start_timerEx
   \   0000C6   7C64         MOV     R4,#0x64
   \   0000C8   7D00         MOV     R5,#0x0
   \   0000CA   7A00         MOV     R2,#0x0
   \   0000CC   7B08         MOV     R3,#0x8
   \   0000CE   90....       MOV     DPTR,#NWK_TaskID
   \   0000D1   12....       LCALL   ??Subroutine32_0 & 0xFFFF
    474              }
    475          
    476              // Return unprocessed events
    477              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_58:
   \   0000D4   7410         MOV     A,#0x10
   \   0000D6   80A6         SJMP    ??ZDApp_event_loop_10
    478            }
    479          
    480            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_14:
   \   0000D8   EE           MOV     A,R6
   \   0000D9   5408         ANL     A,#0x8
   \   0000DB   6006         JZ      ??ZDApp_event_loop_15
    481            {
    482              // User defined logic
    483          
    484              // Return unprocessed events
    485              return (events ^ ZDO_COMMAND_CNF);
   \   0000DD   7408         MOV     A,#0x8
   \   0000DF   6E           XRL     A,R6
   \   0000E0   FA           MOV     R2,A
   \   0000E1   801A         SJMP    ??ZDApp_event_loop_5
    486            }
    487          
    488            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_15:
   \   0000E3   7402         MOV     A,#0x2
   \   0000E5   5F           ANL     A,R7
   \   0000E6   F9           MOV     R1,A
   \   0000E7   E4           CLR     A
   \   0000E8   7001         JNZ     ??ZDApp_event_loop_16
   \   0000EA   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_16:
   \   0000EB   6004         JZ      ??ZDApp_event_loop_17
    489            {
    490              ZDApp_SaveNetworkStateEvt();
    491            
    492              // Return unprocessed events
    493              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000ED   7402         MOV     A,#0x2
   \   0000EF   8081         SJMP    ??ZDApp_event_loop_8
    494            }
    495          
    496            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_17:
   \   0000F1   EE           MOV     A,R6
   \   0000F2   5404         ANL     A,#0x4
   \   0000F4   6003         JZ      ??ZDApp_event_loop_18
    497            {
    498              // The device has been in the UNAUTH state, so reset
    499              // Note: there will be no return from this call
    500              SystemResetSoft();
   \   0000F6                ; Setup parameters for call to function Onboard_soft_reset
   \   0000F6   12....       LCALL   Onboard_soft_reset & 0xFFFF
    501            }
    502          
    503            if ( ZG_SECURE_ENABLED )
    504            {
    505              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    506            }
    507            else
    508            {
    509              // Discard or make more handlers
    510              return 0;
   \                     ??ZDApp_event_loop_18:
   \   0000F9   7A00         MOV     R2,#0x0
   \   0000FB   7B00         MOV     R3,#0x0
    511            }
   \                     ??ZDApp_event_loop_5:
   \   0000FD   02....       LJMP    ??Subroutine36_0 & 0xFFFF
    512          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   7A10         MOV     R2,#0x10
   \   000002                REQUIRE ??Subroutine29_0
   \   000002                ; // Fall through to label ??Subroutine29_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine29_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine32_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine36_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    513          
    514          /*********************************************************************
    515           * @fn      ZDApp_ProcessSecEvent()
    516           *
    517           * @brief   Process incoming security events.
    518           *
    519           * @param   task_id - Task ID
    520           * @param   events  - Bitmap of events
    521           *
    522           * @return  none
    523           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    524          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    525          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    526            (void)task_id;  // Intentionally unreferenced parameter
    527          
    528            if ( ZSTACK_ROUTER_BUILD )
    529            {
    530              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6019         JZ      ??ZDApp_ProcessSecEvent_0
    531              {
    532                // process the new device event
    533                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7009         JNZ     ??CrossCallReturnLabel_55
    534                {
    535                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   7A40         MOV     R2,#0x40
   \   00001C   12....       LCALL   ?Subroutine15 & 0xFFFF
    536                }
    537          
    538                // Return unprocessed events
    539                return (events ^ ZDO_NEW_DEVICE);
   \                     ??CrossCallReturnLabel_55:
   \   00001F   7440         MOV     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000021   6E           XRL     A,R6
   \   000022   FA           MOV     R2,A
   \   000023   EF           MOV     A,R7
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000024   FB           MOV     R3,A
   \   000025   8063         SJMP    ??ZDApp_ProcessSecEvent_3
    540              }
    541            }
    542          
    543            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH)
    544                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    545            {
    546              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    547              {
    548                if ( events & ZDO_SECMGR_EVENT )
    549                {
    550                  ZDSecMgrEvent();
    551          
    552                  // Return unprocessed events
    553                  return (events ^ ZDO_SECMGR_EVENT);
    554                }
    555              }
    556            }
    557          
    558            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000027   EE           MOV     A,R6
   \   000028   5480         ANL     A,#0x80
   \   00002A   6007         JZ      ??ZDApp_ProcessSecEvent_4
    559            {
    560              ZDApp_DeviceAuthEvt();
   \   00002C                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00002C   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    561          
    562              // Return unprocessed events
    563              return (events ^ ZDO_DEVICE_AUTH);
   \   00002F   7480         MOV     A,#-0x80
   \   000031   80EE         SJMP    ??ZDApp_ProcessSecEvent_1
    564            }
    565          
    566            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_4:
   \   000033   7404         MOV     A,#0x4
   \   000035   5F           ANL     A,R7
   \   000036   F9           MOV     R1,A
   \   000037   E4           CLR     A
   \   000038   7001         JNZ     ??ZDApp_ProcessSecEvent_5
   \   00003A   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_5:
   \   00003B   6027         JZ      ??ZDApp_ProcessSecEvent_6
    567            {
    568              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   00003D   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000040   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000043   7401         MOV     A,#0x1
   \   000045   28           ADD     A,R0
   \   000046   FA           MOV     R2,A
   \   000047   E4           CLR     A
   \   000048   39           ADDC    A,R1
   \   000049   FB           MOV     R3,A
   \   00004A   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004D   12....       LCALL   ??Subroutine37_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_65:
   \   000050   C3           CLR     C
   \   000051   E8           MOV     A,R0
   \   000052   94E9         SUBB    A,#-0x17
   \   000054   E9           MOV     A,R1
   \   000055   9403         SUBB    A,#0x3
   \   000057   4003         JC      ??ZDApp_ProcessSecEvent_7
    569              {
    570                ZDApp_SaveNwkKey();
   \   000059                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000059   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    571              }
    572          
    573              // Return unprocessed events
    574              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_7:
   \   00005C   EE           MOV     A,R6
   \   00005D   FA           MOV     R2,A
   \   00005E   7404         MOV     A,#0x4
   \                     ??ZDApp_ProcessSecEvent_8:
   \   000060   6F           XRL     A,R7
   \   000061   FB           MOV     R3,A
   \   000062   8026         SJMP    ??ZDApp_ProcessSecEvent_3
    575            }
    576          
    577            if ( events & ZDO_APS_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_6:
   \   000064   7410         MOV     A,#0x10
   \   000066   5F           ANL     A,R7
   \   000067   F9           MOV     R1,A
   \   000068   E4           CLR     A
   \   000069   7001         JNZ     ??ZDApp_ProcessSecEvent_9
   \   00006B   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_9:
   \   00006C   6005         JZ      ??ZDApp_ProcessSecEvent_10
    578            {
    579          #if defined (NV_RESTORE)
    580              ZDSecMgrSaveApsLinkKey();
    581          #endif // (NV_RESTORE)
    582              
    583              // Return unprocessed events
    584              return (events ^ ZDO_APS_FRAMECOUNTER_CHANGE);
   \   00006E   7410         MOV     A,#0x10
   \   000070   6F           XRL     A,R7
   \   000071   80B1         SJMP    ??ZDApp_ProcessSecEvent_2
    585            }
    586          
    587            if ( events & ZDO_TCLK_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_10:
   \   000073   7408         MOV     A,#0x8
   \   000075   5F           ANL     A,R7
   \   000076   F9           MOV     R1,A
   \   000077   E4           CLR     A
   \   000078   7001         JNZ     ??ZDApp_ProcessSecEvent_11
   \   00007A   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_11:
   \   00007B   6009         JZ      ??ZDApp_ProcessSecEvent_12
    588            {
    589              ZDSecMgrSaveTCLinkKey();
   \   00007D                ; Setup parameters for call to function ZDSecMgrSaveTCLinkKey
   \   00007D   12....       LCALL   ??ZDSecMgrSaveTCLinkKey?relay
    590              
    591              // Return unprocessed events
    592              return (events ^ ZDO_TCLK_FRAMECOUNTER_CHANGE);
   \   000080   EE           MOV     A,R6
   \   000081   FA           MOV     R2,A
   \   000082   7408         MOV     A,#0x8
   \   000084   80DA         SJMP    ??ZDApp_ProcessSecEvent_8
    593            }
    594            
    595            // Discard or make more handlers
    596            return 0;
   \                     ??ZDApp_ProcessSecEvent_12:
   \   000086   7A00         MOV     R2,#0x0
   \   000088   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_3:
   \   00008A   02....       LJMP    ??Subroutine33_0 & 0xFFFF
    597          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005                REQUIRE ??Subroutine32_0
   \   000005                ; // Fall through to label ??Subroutine32_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine37_0:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   22           RET
    598          
    599          /*********************************************************************
    600           * Application Functions
    601           */
    602          
    603          /*********************************************************************
    604           * @fn      ZDOInitDevice
    605           *
    606           * @brief   Start the device in the network.  This function will read
    607           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    608           *   restore the network state of the device.
    609           *
    610           * @param   startDelay - timeDelay to start device (in milliseconds).
    611           *      There is a jitter added to this delay:
    612           *              ((NWK_START_DELAY + startDelay)
    613           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    614           *
    615           * NOTE:    If the application would like to force a "new" join, the
    616           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    617           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    618           *          this function. "new" join means to not restore the network
    619           *          state of the device. Use zgWriteStartupOptions() to set these
    620           *          options.
    621           *
    622           * @return
    623           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    624           *          restored.
    625           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    626           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    627           *          it could mean that there was no network state to restore.
    628           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    629           *          with the rejoin option set to TRUE.  So, the device was not
    630           *          started in the network (one time only).  The next time this
    631           *          function is called it will start.
    632           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    633          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    634          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine10 & 0xFFFF
    635            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    636            uint16 extendedDelay = 0;
    637          
    638            if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_69:
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   E0           MOVX    A,@DPTR
   \   000011   7005         JNZ     ??ZDOInitDevice_0
    639            {
    640              // Initialize the RAM items table, in case an NV item has been updated.
    641              zgInitItems( FALSE );
   \   000013                ; Setup parameters for call to function zgInitItems
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??zgInitItems?relay
    642            }
    643          
    644            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000018                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000018   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    645            //devtag.071807.todo - fix this temporary solution
    646            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001B   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   90....       MOV     DPTR,#(_NIB + 14)
   \   000022   F0           MOVX    @DPTR,A
    647          
    648            devState = DEV_INIT;    // Remove the Hold state
   \   000023   7401         MOV     A,#0x1
   \   000025   90....       MOV     DPTR,#devState
   \   000028   F0           MOVX    @DPTR,A
    649          
    650            // Initialize leave control logic
    651            ZDApp_LeaveCtrlInit();
   \   000029                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000029   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    652          
    653            // Check leave control reset settings
    654            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   00002C                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   00002C   85..82       MOV     DPL,?XSP + 0
   \   00002F   85..83       MOV     DPH,?XSP + 1
   \   000032   AC82         MOV     R4,DPL
   \   000034   AD83         MOV     R5,DPH
   \   000036   7A..         MOV     R2,#(devState & 0xff)
   \   000038   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   00003A   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    655          
    656            // Leave may make the hold state come back
    657            if ( devState == DEV_HOLD )
   \   00003D   90....       MOV     DPTR,#devState
   \   000040   E0           MOVX    A,@DPTR
   \   000041   700E         JNZ     ??ZDOInitDevice_1
    658            {
    659              // Set the NV startup option to force a "new" join.
    660              zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000043                ; Setup parameters for call to function zgWriteStartupOptions
   \   000043   7A02         MOV     R2,#0x2
   \   000045   79FF         MOV     R1,#-0x1
   \   000047   12....       LCALL   ??zgWriteStartupOptions?relay
    661          
    662              // Notify the applications
    663              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00004A                ; Setup parameters for call to function osal_set_event
   \   00004A   12....       LCALL   ?Subroutine13 & 0xFFFF
    664          
    665              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_41:
   \   00004D   7902         MOV     R1,#0x2
   \   00004F   803A         SJMP    ??ZDOInitDevice_2
    666            }
    667          
    668          #if defined ( NV_RESTORE )
    669            // Get Keypad directly to see if a reset nv is needed.
    670            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    671            // while booting to skip past NV Restore.
    672            if ( HalKeyRead() == SW_BYPASS_NV )
    673              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    674            else
    675            {
    676              // Determine if NV should be restored
    677              networkStateNV = ZDApp_ReadNetworkRestoreState();
    678            }
    679          
    680            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    681            {
    682              networkStateNV = ZDApp_RestoreNetworkState();
    683            }
    684            else
    685            {
    686              // Wipe out the network state in NV
    687              NLME_InitNV();
    688              NLME_SetDefaultNV();
    689              // clear NWK key values
    690              ZDSecMgrClearNVKeyValues();
    691            }
    692          #endif
    693          
    694            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    695            {
    696              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   000051                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000051   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    697          
    698              // Only delay if joining network - not restoring network state
    699              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    700                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000054                ; Setup parameters for call to function osal_rand
   \   000054   12....       LCALL   ??osal_rand?relay
   \   000057   8A..         MOV     ?V0 + 0,R2
   \   000059   A8..         MOV     R0,?V0 + 0
   \   00005B   85..82       MOV     DPL,?XSP + 0
   \   00005E   85..83       MOV     DPH,?XSP + 1
   \   000061   747F         MOV     A,#0x7f
   \   000063   58           ANL     A,R0
   \   000064   F8           MOV     R0,A
   \   000065   E0           MOVX    A,@DPTR
   \   000066   28           ADD     A,R0
   \   000067   F8           MOV     R0,A
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   3400         ADDC    A,#0x0
   \   00006C   F9           MOV     R1,A
   \   00006D   74E8         MOV     A,#-0x18
   \   00006F   28           ADD     A,R0
   \   000070   FE           MOV     R6,A
   \   000071   7403         MOV     A,#0x3
   \   000073   39           ADDC    A,R1
   \   000074   FF           MOV     R7,A
    701            }
    702          
    703            // Initialize the security for type of device
    704            ZDApp_SecInit( networkStateNV );
   \   000075                ; Setup parameters for call to function ZDApp_SecInit
   \   000075   7901         MOV     R1,#0x1
   \   000077   12....       LCALL   ??ZDApp_SecInit?relay
    705          
    706            // Trigger the network start
    707            ZDApp_NetworkInit( extendedDelay );
   \   00007A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00007A   EE           MOV     A,R6
   \   00007B   FA           MOV     R2,A
   \   00007C   EF           MOV     A,R7
   \   00007D   FB           MOV     R3,A
   \   00007E   12....       LCALL   ??ZDApp_NetworkInit?relay
    708          
    709            // set broadcast address mask to support broadcast filtering
    710            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000081                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000081   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000084   E0           MOVX    A,@DPTR
   \   000085   F9           MOV     R1,A
   \   000086   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    711          
    712            return ( networkStateNV );
   \   000089   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   00008B   02....       LJMP    ?Subroutine1 & 0xFFFF
    713          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine35_0
   \   000002                ; // Fall through to label ??Subroutine35_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine35_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine36_0
   \   000003                ; // Fall through to label ??Subroutine36_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine37_0
   \   000006                ; // Fall through to label ??Subroutine37_0
    714          
    715          /*********************************************************************
    716           * @fn      ZDApp_ReadNetworkRestoreState
    717           *
    718           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    719           *          or not to restore the network state.
    720           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    721           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    722           *
    723           * @param   none
    724           *
    725           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    726           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    727           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    728           *          ZCD_NV_STARTUP_OPTION
    729           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    730          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    731          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    732            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    733          
    734            // Look for the New Network State option.
    735            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    736            {
    737              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    738            }
    739          
    740            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ??Subroutine33_0 & 0xFFFF
    741          }
    742          
    743          /*********************************************************************
    744           * @fn      ZDAppDetermineDeviceType()
    745           *
    746           * @brief   Determines the type of device to start.
    747           *
    748           *          Looks at zgDeviceLogicalType and determines what type of
    749           *          device to start.  The types are:
    750           *            ZG_DEVICETYPE_COORDINATOR
    751           *            ZG_DEVICETYPE_ROUTER
    752           *            ZG_DEVICETYPE_ENDDEVICE
    753           *
    754           * @param   none
    755           *
    756           * @return  none
    757           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    758          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    759          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    760            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    761            {
    762              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#devStartMode
   \   00000F   F0           MOVX    @DPTR,A
    763              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    764            }
    765            else
    766            {
    767              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    768                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    769              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    770                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    771          
    772              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    773              // The device shall do rejoin the network. Otherwise, do normal join
    774              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#(AIB_apsUseExtendedPANID & 0xff)
   \   000036   7B..         MOV     R3,#((AIB_apsUseExtendedPANID >> 8) & 0xff)
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   7003         JNZ     ??ZDAppDetermineDeviceType_5
    775              {
    776                devStartMode = MODE_JOIN;     // Assume joining
   \   00003E   E4           CLR     A
   \   00003F   8002         SJMP    ??ZDAppDetermineDeviceType_6
    777              }
    778              else
    779              {
    780                devStartMode = MODE_REJOIN;
   \                     ??ZDAppDetermineDeviceType_5:
   \   000041   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_6:
   \   000043   90....       MOV     DPTR,#devStartMode
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    781              }
    782            }
    783          }
   \   000047   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    784          
    785          /*********************************************************************
    786           * @fn      ZDApp_NetworkStartEvt()
    787           *
    788           * @brief   Process the Network Start Event
    789           *
    790           * @param   none
    791           *
    792           * @return  none
    793           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    794          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    795          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    796            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    797            {
    798              // Successfully started a ZigBee network
    799              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    800              {
    801                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    802              }
    803          
    804              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    805              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    806            }
    807            else
    808            {
    809              // Try again with a higher energy threshold !!
    810              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    811              {
    812                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    813                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    814              }
    815              else
    816              {
    817                // Failed to start network. Enter a dormant state (until user intervenes)
    818                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    819                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
    820              }
    821            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   12....       LCALL   ??Subroutine29_0 & 0xFFFF
    822          }
   \                     ??CrossCallReturnLabel_44:
   \   00004E   02....       LJMP    ?Subroutine2 & 0xFFFF
    823          
    824          /*********************************************************************
    825           * @fn      ZDApp_DeviceAuthEvt()
    826           *
    827           * @brief   Process the Device Authentic Event
    828           *
    829           * @param   none
    830           *
    831           * @return  none
    832           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    833          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    834          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    835            // received authentication from trust center
    836            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   702D         JNZ     ??ZDApp_DeviceAuthEvt_0
    837            {
    838              // Stop the reset timer so it doesn't reset
    839              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    840          
    841              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine8 & 0xFFFF
    842              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    843          
    844              // Set the Power Manager Device
    845          #if defined ( POWER_SAVING )
    846              osal_pwrmgr_device( PWRMGR_BATTERY );
    847          #endif
    848          
    849              if ( ZSTACK_ROUTER_BUILD )
    850              {
    851                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_0:
   \   000012   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000015   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    852                {
    853                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    854                  NLME_StartRouterRequest( 0, 0, false );
   \   000017                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??NLME_StartRouterRequest?relay
    855                }
    856              }
    857          
    858              // Notify to save info into NV
    859              ZDApp_NVUpdate();
    860          
    861              // Save off the security
    862              ZDApp_SaveNwkKey();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000020                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000020   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    863          
    864              ZDApp_AnnounceNewAddress();
   \   000023                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000023   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    865          
    866              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000026   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   A2E3         MOV     C,0xE0 /* A   */.3
   \   00002C   400B         JC      ??ZDApp_DeviceAuthEvt_0
    867              {
    868                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   00002E                ; Setup parameters for call to function NLME_SetPollRate
   \   00002E   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000031   E0           MOVX    A,@DPTR
   \   000032   FA           MOV     R2,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FB           MOV     R3,A
   \   000036   12....       LCALL   ??NLME_SetPollRate?relay
    869              }
    870            }
    871            else
    872            {
    873              ZDApp_NVUpdate();
    874            }
    875          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000039   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000003   E0           MOVX    A,@DPTR
   \   000004   5407         ANL     A,#0x7
   \   000006   6402         XRL     A,#0x2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   7406         MOV     A,#0x6
   \   000002   90....       MOV     DPTR,#devState
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008   7B00         MOV     R3,#0x0
   \   00000A   90....       MOV     DPTR,#ZDAppTaskID
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F9           MOV     R1,A
   \   00000F   12....       LCALL   ??osal_set_event?relay
   \   000012   22           RET
    876          
    877          /*********************************************************************
    878           * @fn      ZDApp_SaveNetworkStateEvt()
    879           *
    880           * @brief   Process the Save the Network State Event
    881           *
    882           * @param   none
    883           *
    884           * @return  none
    885           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    886          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    887          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    888          #if defined ( NV_RESTORE )
    889           #if defined ( NV_TURN_OFF_RADIO )
    890            // Turn off the radio's receiver during an NV update
    891            uint8 RxOnIdle;
    892            uint8 x = false;
    893            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    894            ZMacSetReq( ZMacRxOnIdle, &x );
    895           #endif
    896          
    897            // Update the Network State in NV
    898            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    899                           NWK_NV_DEVICELIST_ENABLE |
    900                           NWK_NV_BINDING_ENABLE    |
    901                           NWK_NV_ADDRMGR_ENABLE );
    902          
    903            // Reset the NV startup option to resume from NV by
    904            // clearing the "New" join option.
    905            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    906          
    907           #if defined ( NV_TURN_OFF_RADIO )
    908            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    909           #endif
    910          #endif  // NV_RESTORE
    911          }
   \   000000   02....       LJMP    ?BRET
    912          
    913          /*********************************************************************
    914           * @fn      ZDApp_RestoreNetworkState()
    915           *
    916           * @brief   This function will restore the network state of the
    917           *          device if the network state is stored in NV.
    918           *
    919           * @param   none
    920           *
    921           * @return
    922           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    923           *          restored.
    924           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    925           *          This could mean that zgStartupOption said to not restore, or
    926           *          it could mean that there was no network state to restore.
    927           *
    928           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    929          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    930          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    931            uint8 nvStat;
    932          
    933            // Initialize NWK NV items
    934            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    935          
    936            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   602F         JZ      ??ZDApp_RestoreNetworkState_0
    937            {
    938              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6029         JZ      ??ZDApp_RestoreNetworkState_0
    939              {
    940                // Are we a coordinator
    941                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   12....       LCALL   ??Subroutine37_0 & 0xFFFF
    942                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \                     ??CrossCallReturnLabel_66:
   \   00001E   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000021   E0           MOVX    A,@DPTR
   \   000022   7002         JNZ     ??ZDApp_RestoreNetworkState_1
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000026   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    943                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000028   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   54F8         ANL     A,#0xf8
   \   00002E   F0           MOVX    @DPTR,A
    944                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   00002F   7401         MOV     A,#0x1
   \   000031   90....       MOV     DPTR,#devStartMode
   \   000034   12....       LCALL   ?Subroutine9 & 0xFFFF
    945                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
    946              }
    947              else
    948                nvStat = NV_ITEM_UNINIT;
    949          
    950              if ( ZG_SECURE_ENABLED )
    951              {
    952                nwkFrameCounterChanges = 0;
    953          
    954                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    955                {
    956                  ZDApp_RestoreNwkKey();
    957                }
    958              }
    959          
    960              // The default for RxOnWhenIdle is true for Routers and false for end devices
    961              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    962              // other than default.
    963            }
    964          
    965            if ( nvStat == ZSUCCESS )
   \                     ??CrossCallReturnLabel_2:
   \   000037   EE           MOV     A,R6
   \   000038   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    966              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   00003A   7900         MOV     R1,#0x0
   \   00003C   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    967            else
    968              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   00003E   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000040   02....       LJMP    ??Subroutine33_0 & 0xFFFF
    969          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001                ; Setup parameters for call to function sAddrExtCpy
   \   000001   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   000003   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   000005   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000007   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000009   12....       LCALL   ??sAddrExtCpy?relay
   \   00000C   22           RET
    970          
    971          /*********************************************************************
    972           * @fn      ZDApp_InitUserDesc()
    973           *
    974           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    975           *          when needed.  If you want to initialize the User descriptor to
    976           *          something other than all zero, do it here.
    977           *
    978           * @param   none
    979           *
    980           * @return  none
    981           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    982          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    983          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    984            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    985          
    986            // Initialize the User Descriptor, the descriptor is read from NV
    987            // when needed.  If you want to initialize the User descriptor to something
    988            // other than all zero, do it here.
    989            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine24 & 0xFFFF
    990            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    991                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_34:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    992            {
    993              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    994                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    995              {
    996                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    997                {
    998                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    999                }
   1000              }
   1001            }
   1002          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine35_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine24:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
   1003          
   1004          /*********************************************************************
   1005           * @fn      ZDAppCheckForHoldKey()
   1006           *
   1007           * @brief   Check for key to set the device into Hold Auto Start
   1008           *
   1009           * @param   none
   1010           *
   1011           * @return  none
   1012           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1013          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
   1014          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1015          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
   1016            // Get Keypad directly to see if a HOLD_START is needed.
   1017            // Hold down the SW_BYPASS_START key (see OnBoard.h)
   1018            // while booting to avoid starting up the device.
   1019            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
   1020            {
   1021              // Change the device state to HOLD on start up
   1022              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
   1023            }
   1024          #endif // HAL_KEY
   1025          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ?Subroutine2 & 0xFFFF
   1026          
   1027          /*********************************************************************
   1028           * @fn      ZDApp_ProcessOSALMsg()
   1029           *
   1030           * @brief   Process the incoming task message.
   1031           *
   1032           * @param   msgPtr - message to process
   1033           *
   1034           * @return  none
   1035           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1036          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
   1037          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1038            // Data Confirmation message fields
   1039            uint8 sentEP;       // This should always be 0
   1040            uint8 sentStatus;
   1041            afDataConfirm_t *afDataConfirm;
   1042            uint8 tmp;
   1043          
   1044            switch ( msgPtr->event )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   E0           MOVX    A,@DPTR
   \   000013   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   000016   00           DB        0
   \   000017   06           DB        6
   \   000018   01           DB        1
   \   000019   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   00001B   02           DB        2
   \   00001C   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   00001E   03           DB        3
   \   00001F   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   000021   1A           DB        26
   \   000022   ....         DW        ??ZDApp_ProcessOSALMsg_3
   \   000024   D3           DB        211
   \   000025   ....         DW        ??ZDApp_ProcessOSALMsg_4
   \   000027   FD           DB        253
   \   000028   ....         DW        ??ZDApp_ProcessOSALMsg_5
   \   00002A   ....         DW        ??ZDApp_ProcessOSALMsg_6
   1045            {
   1046              // Incoming ZDO Message
   1047              case AF_INCOMING_MSG_CMD:
   1048                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   00002C                ; Setup parameters for call to function ZDP_IncomingData
   \   00002C   12....       LCALL   ??ZDP_IncomingData?relay
   \   00002F   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1049                break;
   1050          
   1051              case ZDO_CB_MSG:
   1052                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   000032                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   000032   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   000035   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1053                break;
   1054          
   1055              case AF_DATA_CONFIRM_CMD:
   1056                // This message is received as a confirmation of a data packet sent.
   1057                // The status is of ZStatus_t type [defined in NLMEDE.h]
   1058                // The message fields are defined in AF.h
   1059                afDataConfirm = (afDataConfirm_t *)msgPtr;
   1060                sentEP = afDataConfirm->endpoint;
   1061                sentStatus = afDataConfirm->hdr.status;
   1062          
   1063                // Action taken when confirmation is received.
   1064          #if defined ( ZIGBEE_FREQ_AGILITY )
   1065                if ( pZDNwkMgr_ProcessDataConfirm )
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000038   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7002         JNZ     ??ZDApp_ProcessOSALMsg_7
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   000040   7003         JNZ     $+5
   \   000042   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1066                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   000045                ; Setup parameters for indirect call
   \   000045   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000048   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   00004B   12....       LCALL   ?CALL_IND
   \   00004E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1067          #endif
   1068                (void)sentEP;
   1069                (void)sentStatus;
   1070                break;
   1071          
   1072              case ZDO_NWK_DISC_CNF:
   1073                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000051   90....       MOV     DPTR,#devState
   \   000054   E0           MOVX    A,@DPTR
   \   000055   6402         XRL     A,#0x2
   \   000057   6003         JZ      $+5
   \   000059   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1074                  break;
   1075          
   1076                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   00005C   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   6401         XRL     A,#0x1
   \   000062   6008         JZ      ??ZDApp_ProcessOSALMsg_8
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6402         XRL     A,#0x2
   \   000067   6003         JZ      $+5
   \   000069   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
   1077                {
   1078                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   00006C   8E82         MOV     DPL,R6
   \   00006E   8F83         MOV     DPH,R7
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   6003         JZ      $+5
   \   000074   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   \   000077   90....       MOV     DPTR,#zdoDiscCounter
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   C3           CLR     C
   \   00007C   9403         SUBB    A,#0x3
   \   00007E   5003         JNC     $+5
   \   000080   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   1079                  {
   1080                    if ( devStartMode == MODE_JOIN )
   \   000083   EE           MOV     A,R6
   \   000084   2404         ADD     A,#0x4
   \   000086   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000089   2403         ADD     A,#0x3
   \   00008B   18           DEC     R0
   \   00008C   EF           MOV     A,R7
   \   00008D   3400         ADDC    A,#0x0
   \   00008F   F9           MOV     R1,A
   \   000090   88..         MOV     ?V0 + 2,R0
   \   000092   89..         MOV     ?V0 + 3,R1
   \   000094   EE           MOV     A,R6
   \   000095   2402         ADD     A,#0x2
   \   000097   18           DEC     R0
   \   000098   EF           MOV     A,R7
   \   000099   3400         ADDC    A,#0x0
   \   00009B   F9           MOV     R1,A
   \   00009C   88..         MOV     ?V0 + 4,R0
   \   00009E   89..         MOV     ?V0 + 5,R1
   \   0000A0   90....       MOV     DPTR,#devStartMode
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   703E         JNZ     ??ZDApp_ProcessOSALMsg_10
   1081                    {
   1082                      devState = DEV_NWK_JOINING;
   \   0000A6   7403         MOV     A,#0x3
   \   0000A8   90....       MOV     DPTR,#devState
   \   0000AB   F0           MOVX    @DPTR,A
   1083          
   1084                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   0000AC                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   0000AC   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1085          
   1086                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
   1087                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
   1088                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
   1089                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   0000AF                ; Setup parameters for call to function NLME_JoinRequest
   \   0000AF   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   F5..         MOV     ?V0 + 6,A
   \   0000B5   78..         MOV     R0,#?V0 + 6
   \   0000B7   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000BA   85..82       MOV     DPL,?V0 + 0
   \   0000BD   85..83       MOV     DPH,?V0 + 1
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   F9           MOV     R1,A
   \   0000C2   85..82       MOV     DPL,?V0 + 4
   \   0000C5   85..83       MOV     DPH,?V0 + 5
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   FC           MOV     R4,A
   \   0000CA   85..82       MOV     DPL,?V0 + 2
   \   0000CD   85..83       MOV     DPH,?V0 + 3
   \   0000D0   E0           MOVX    A,@DPTR
   \   0000D1   FD           MOV     R5,A
   \   0000D2   EE           MOV     A,R6
   \   0000D3   2406         ADD     A,#0x6
   \   0000D5   FA           MOV     R2,A
   \   0000D6   EF           MOV     A,R7
   \   0000D7   3400         ADDC    A,#0x0
   \   0000D9   FB           MOV     R3,A
   \   0000DA   12....       LCALL   ??NLME_JoinRequest?relay
   \   0000DD   7401         MOV     A,#0x1
   \   0000DF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E2   807A         SJMP    ??ZDApp_ProcessOSALMsg_11
   1090                      {
   1091                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1092                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1093                      }
   1094                    }
   1095                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   0000E4   6403         XRL     A,#0x3
   \   0000E6   707C         JNZ     ??CrossCallReturnLabel_30
   1096                    {
   1097                      devState = DEV_NWK_REJOIN;
   \   0000E8   7404         MOV     A,#0x4
   \   0000EA   90....       MOV     DPTR,#devState
   \   0000ED   F0           MOVX    @DPTR,A
   1098          
   1099                      // Before trying to do rejoin, check if the device has a valid short address
   1100                      // If not, generate a random short address for itself
   1101                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   0000EE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   64FE         XRL     A,#0xfe
   \   0000F4   7004         JNZ     ??ZDApp_ProcessOSALMsg_12
   \   0000F6   A3           INC     DPTR
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   0000FA   7012         JNZ     ??ZDApp_ProcessOSALMsg_13
   1102                      {
   1103                        _NIB.nwkDevAddress = osal_rand();
   \   0000FC                ; Setup parameters for call to function osal_rand
   \   0000FC   12....       LCALL   ??osal_rand?relay
   \   0000FF   90....       MOV     DPTR,#(_NIB + 20)
   \   000102   12....       LCALL   ??Subroutine37_0 & 0xFFFF
   1104                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \                     ??CrossCallReturnLabel_67:
   \   000105                ; Setup parameters for call to function ZMacSetReq
   \   000105   7A..         MOV     R2,#((_NIB + 20) & 0xff)
   \   000107   7B..         MOV     R3,#(((_NIB + 20) >> 8) & 0xff)
   \   000109   7953         MOV     R1,#0x53
   \   00010B   12....       LCALL   ??ZMacSetReq?relay
   1105                      }
   1106          
   1107                      if ( ZG_SECURE_ENABLED )
   1108                      {
   1109                        ZDApp_RestoreNwkKey();
   1110                      }
   1111          
   1112                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1113                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   00010E   90....       MOV     DPTR,#(_NIB + 33)
   \   000111   E0           MOVX    A,@DPTR
   \   000112   64FE         XRL     A,#0xfe
   \   000114   7004         JNZ     ??ZDApp_ProcessOSALMsg_14
   \   000116   A3           INC     DPTR
   \   000117   E0           MOVX    A,@DPTR
   \   000118   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   00011A   7021         JNZ     ??ZDApp_ProcessOSALMsg_15
   1114                      {
   1115                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   \   00011C   85..82       MOV     DPL,?V0 + 4
   \   00011F   85..83       MOV     DPH,?V0 + 5
   \   000122   E0           MOVX    A,@DPTR
   \   000123   FA           MOV     R2,A
   \   000124   85..82       MOV     DPL,?V0 + 2
   \   000127   85..83       MOV     DPH,?V0 + 3
   \   00012A   E0           MOVX    A,@DPTR
   \   00012B   F9           MOV     R1,A
   \   00012C   EA           MOV     A,R2
   \   00012D   90....       MOV     DPTR,#(_NIB + 33)
   \   000130   F0           MOVX    @DPTR,A
   \   000131   A3           INC     DPTR
   \   000132   E9           MOV     A,R1
   \   000133   F0           MOVX    @DPTR,A
   1116                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   000134                ; Setup parameters for call to function ZMacSetReq
   \   000134   7A..         MOV     R2,#((_NIB + 33) & 0xff)
   \   000136   7B..         MOV     R3,#(((_NIB + 33) >> 8) & 0xff)
   \   000138   7950         MOV     R1,#0x50
   \   00013A   12....       LCALL   ??ZMacSetReq?relay
   1117                      }
   1118          
   1119                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   00013D   7401         MOV     A,#0x1
   \   00013F   85..82       MOV     DPL,?XSP + 0
   \   000142   85..83       MOV     DPH,?XSP + 1
   \   000145   F0           MOVX    @DPTR,A
   1120                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   \   000146                ; Setup parameters for call to function ZMacSetReq
   \   000146   AA82         MOV     R2,DPL
   \   000148   AB83         MOV     R3,DPH
   \   00014A   7952         MOV     R1,#0x52
   \   00014C   12....       LCALL   ??ZMacSetReq?relay
   1121                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   \   00014F                ; Setup parameters for call to function NLME_ReJoinRequest
   \   00014F   85..82       MOV     DPL,?V0 + 0
   \   000152   85..83       MOV     DPH,?V0 + 1
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F9           MOV     R1,A
   \   000157   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000159   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   00015B   12....       LCALL   ??NLME_ReJoinRequest?relay
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   00015E   E9           MOV     A,R1
   \   00015F   6003         JZ      ??CrossCallReturnLabel_30
   1122                      {
   1123                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1124                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000161                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000161                ; Setup parameters for call to function osal_rand
   \   000161   12....       LCALL   ?Subroutine22 & 0xFFFF
   1125                      }
   1126                    }
   1127          
   1128                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_30:
   \   000164   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000167   E0           MOVX    A,@DPTR
   \   000168   A2E3         MOV     C,0xE0 /* A   */.3
   \   00016A   505A         JNC     ??ZDApp_ProcessOSALMsg_6
   1129                    {
   1130                      // The receiver is on, turn network layer polling off.
   1131                      NLME_SetPollRate( 0 );
   \   00016C                ; Setup parameters for call to function NLME_SetPollRate
   \   00016C   12....       LCALL   ?Subroutine23 & 0xFFFF
   1132                      NLME_SetQueuedPollRate( 0 );
   1133                      NLME_SetResponseRate( 0 );
   1134                    }
   1135                    else
   1136                    {
   1137                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1138                      {
   1139                        ZDApp_SavedPollRate = zgPollRate;
   1140                        NLME_SetPollRate( zgRejoinPollRate );
   1141                      }
   1142                    }
   1143                  }
   \                     ??CrossCallReturnLabel_32:
   \   00016F   8055         SJMP    ??ZDApp_ProcessOSALMsg_6
   1144                  else
   1145                  {
   1146                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000171   90....       MOV     DPTR,#continueJoining
   \   000174   E0           MOVX    A,@DPTR
   \   000175   604F         JZ      ??ZDApp_ProcessOSALMsg_6
   1147                    {
   1148              #if defined ( MANAGED_SCAN )
   1149                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1150              #else
   1151                      zdoDiscCounter++;
   \   000177   90....       MOV     DPTR,#zdoDiscCounter
   \   00017A   E0           MOVX    A,@DPTR
   \   00017B   04           INC     A
   \   00017C   F0           MOVX    @DPTR,A
   1152                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1153                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   00017D                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00017D                ; Setup parameters for call to function osal_rand
   \   00017D   12....       LCALL   ??osal_rand?relay
   \   000180   8A..         MOV     ?V0 + 0,R2
   \   000182   74FF         MOV     A,#-0x1
   \   000184   12....       LCALL   ?Subroutine28 & 0xFFFF
   1154              #endif
   1155                    }
   1156                  }
   1157                }
   \                     ??CrossCallReturnLabel_38:
   \   000187   803A         SJMP    ??ZDApp_ProcessOSALMsg_16
   1158                break;
   1159          
   1160              case ZDO_NWK_JOIN_IND:
   1161                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   000189   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00018C   E0           MOVX    A,@DPTR
   \   00018D   6401         XRL     A,#0x1
   \   00018F   6005         JZ      ??ZDApp_ProcessOSALMsg_17
   \   000191   E0           MOVX    A,@DPTR
   \   000192   6402         XRL     A,#0x2
   \   000194   7030         JNZ     ??ZDApp_ProcessOSALMsg_6
   1162                {
   1163                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_17:
   \   000196                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   000196   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   000199   802B         SJMP    ??ZDApp_ProcessOSALMsg_6
   1164                }
   1165                break;
   1166          
   1167              case ZDO_NWK_JOIN_REQ:
   1168                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   00019B   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00019E   E0           MOVX    A,@DPTR
   \   00019F   6401         XRL     A,#0x1
   \   0001A1   6005         JZ      ??ZDApp_ProcessOSALMsg_18
   \   0001A3   E0           MOVX    A,@DPTR
   \   0001A4   6402         XRL     A,#0x2
   \   0001A6   701E         JNZ     ??ZDApp_ProcessOSALMsg_6
   1169                {
   1170                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_18:
   \   0001A8   E4           CLR     A
   \   0001A9   90....       MOV     DPTR,#retryCnt
   \   0001AC   F0           MOVX    @DPTR,A
   1171                  devStartMode = MODE_RESUME;
   \   0001AD   7401         MOV     A,#0x1
   \   0001AF   90....       MOV     DPTR,#devStartMode
   \   0001B2   F0           MOVX    @DPTR,A
   1172                  _tmpRejoinState = true;
   \   0001B3   90....       MOV     DPTR,#_tmpRejoinState
   \   0001B6   12....       LCALL   ?Subroutine9 & 0xFFFF
   1173                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1174                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \                     ??CrossCallReturnLabel_3:
   \   0001B9   7402         MOV     A,#0x2
   \   0001BB   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0001BE   F0           MOVX    @DPTR,A
   1175                  ZDApp_NetworkInit( 0 );
   \   0001BF                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001BF   7A00         MOV     R2,#0x0
   \   0001C1   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   0001C3   12....       LCALL   ??ZDApp_NetworkInit?relay
   1176                }
   1177                break;
   1178          
   1179              default:
   1180                if ( ZG_SECURE_ENABLED )
   1181                  ZDApp_ProcessSecMsg( msgPtr );
   1182                break;
   1183            }
   1184          
   1185          }
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   0001C6   7401         MOV     A,#0x1
   \   0001C8   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001CB   7F07         MOV     R7,#0x7
   \   0001CD   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??NLME_SetPollRate?relay
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E                ; Setup parameters for call to function NLME_SetResponseRate
   \   00000E   7A00         MOV     R2,#0x0
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000015   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   12....       LCALL   ??osal_rand?relay
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005   747F         MOV     A,#0x7f
   \   000007   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   00000A   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine28:
   \   000000   55..         ANL     A,?V0 + 0
   \   000002   F8           MOV     R0,A
   \   000003   74E8         MOV     A,#-0x18
   \   000005   28           ADD     A,R0
   \   000006   FA           MOV     R2,A
   \   000007   7403         MOV     A,#0x3
   \   000009   3400         ADDC    A,#0x0
   \   00000B   FB           MOV     R3,A
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine26:
   \   000000   F8           MOV     R0,A
   \   000001   EF           MOV     A,R7
   \   000002   3400         ADDC    A,#0x0
   \   000004   F9           MOV     R1,A
   \   000005   88..         MOV     ?V0 + 0,R0
   \   000007   89..         MOV     ?V0 + 1,R1
   \   000009   EE           MOV     A,R6
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8882         MOV     DPL,R0
   \   000008   22           RET
   1186          
   1187          /*********************************************************************
   1188           * @fn      ZDApp_ProcessMsgCBs()
   1189           *
   1190           * @brief   Process response messages
   1191           *
   1192           * @param   none
   1193           *
   1194           * @return  none
   1195           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1196          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1197          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1198            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_59:
   \   000014   F5..         MOV     ?V0 + 0,A
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F5..         MOV     ?V0 + 1,A
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   00001F   0200         DW        2
   \   000021   2100         DW        33
   \   000023   2200         DW        34
   \   000025   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000027   0080         DW        32768
   \   000029   0180         DW        32769
   \   00002B   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   00002D   0000         DW        0
   \   00002F   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1199            {
   1200          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1201              case NWK_addr_rsp:
   1202              case IEEE_addr_rsp:
   1203                {
   1204                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1205                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000031                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000031   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   000034   8A..         MOV     ?V0 + 0,R2
   \   000036   8B..         MOV     ?V0 + 1,R3
   \   000038   AE..         MOV     R6,?V0 + 0
   \   00003A   AF..         MOV     R7,?V0 + 1
   1206                  if ( pAddrRsp )
   \   00003C   EE           MOV     A,R6
   \   00003D   7001         JNZ     ??ZDApp_ProcessMsgCBs_3
   \   00003F   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   000040   603F         JZ      ??ZDApp_ProcessMsgCBs_2
   1207                  {
   1208                    if ( pAddrRsp->status == ZSuccess )
   \   000042   8E82         MOV     DPL,R6
   \   000044   8F83         MOV     DPH,R7
   \   000046   E0           MOVX    A,@DPTR
   \   000047   7011         JNZ     ??ZDApp_ProcessMsgCBs_4
   1209                    {
   1210                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000049                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000049   EE           MOV     A,R6
   \   00004A   2403         ADD     A,#0x3
   \   00004C   FC           MOV     R4,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   FD           MOV     R5,A
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FA           MOV     R2,A
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   FB           MOV     R3,A
   \   000057   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1211                    }
   1212                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   00005A                ; Setup parameters for call to function osal_mem_free
   \   00005A   EE           MOV     A,R6
   \   00005B   FA           MOV     R2,A
   \   00005C   EF           MOV     A,R7
   \   00005D   FB           MOV     R3,A
   \   00005E   12....       LCALL   ??osal_mem_free?relay
   \   000061   801E         SJMP    ??ZDApp_ProcessMsgCBs_2
   1213                  }
   1214                }
   1215                break;
   1216          #endif
   1217          
   1218          #if defined ( REFLECTOR )
   1219              case Bind_req:
   1220              case Unbind_req:
   1221                {
   1222                  ZDO_BindUnbindReq_t bindReq;
   1223                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000063                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000063   85..82       MOV     DPL,?XSP + 0
   \   000066   85..83       MOV     DPH,?XSP + 1
   \   000069   AC82         MOV     R4,DPL
   \   00006B   AD83         MOV     R5,DPH
   \   00006D   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1224                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000070                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000070   85..82       MOV     DPL,?XSP + 0
   \   000073   85..83       MOV     DPH,?XSP + 1
   \   000076   AC82         MOV     R4,DPL
   \   000078   AD83         MOV     R5,DPH
   \   00007A   EE           MOV     A,R6
   \   00007B   FA           MOV     R2,A
   \   00007C   EF           MOV     A,R7
   \   00007D   FB           MOV     R3,A
   \   00007E   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1225                }
   1226                break;
   1227          #endif
   1228          
   1229          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1230              case Bind_rsp:
   1231              case Unbind_rsp:
   1232                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   1233                {
   1234                  ZDMatchSendState(
   1235                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1236                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1237                }
   1238                break;
   1239          
   1240              case End_Device_Bind_req:
   1241                if (ZG_DEVICE_COORDINATOR_TYPE)
   1242                {
   1243                  ZDEndDeviceBind_t bindReq;
   1244                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1245                  ZDO_MatchEndDeviceBind( &bindReq );
   1246          
   1247                  // Freeing the cluster lists - if allocated.
   1248                  if ( bindReq.numInClusters )
   1249                    osal_mem_free( bindReq.inClusters );
   1250                  if ( bindReq.numOutClusters )
   1251                    osal_mem_free( bindReq.outClusters );
   1252                }
   1253                break;
   1254          #endif
   1255            }
   1256          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   000081                REQUIRE ?Subroutine7
   \   000081                ; // Fall through to label ?Subroutine7

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7415         MOV     A,#0x15
   \   000002   02....       LJMP    ??Subroutine35_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine34_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET
   1257          
   1258          /*********************************************************************
   1259           * @fn      ZDApp_RegisterCBs()
   1260           *
   1261           * @brief   Process response messages
   1262           *
   1263           * @param   none
   1264           *
   1265           * @return  none
   1266           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1267          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1268          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1269          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1270            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine16 & 0xFFFF
   1271          #endif
   1272          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1273            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_47:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine16 & 0xFFFF
   1274          #endif
   1275          #if ZG_BUILD_COORDINATOR_TYPE
   1276            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1277            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1278            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1279          #endif
   1280          #if defined ( REFLECTOR )
   1281            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_48:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   7B00         MOV     R3,#0x0
   \   000012   12....       LCALL   ??Subroutine30_0 & 0xFFFF
   1282            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_49:
   \   000015                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000015   7A22         MOV     R2,#0x22
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??Subroutine30_0 & 0xFFFF
   1283          #endif
   1284          }
   \                     ??CrossCallReturnLabel_50:
   \   00001C   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine30_0
   \   000002                ; // Fall through to label ??Subroutine30_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine30_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1285          
   1286          /*********************************************************************
   1287           * @fn      ZDApp_ProcessSecMsg()
   1288           *
   1289           * @brief   Process the incoming security message.
   1290           *
   1291           * @param   msgPtr - message to process
   1292           *
   1293           * @return  none
   1294           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1295          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1296          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1297            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   12....       LCALL   ?UC_SWITCH_DENSE
   \                     `?<Jumptable for ZDApp_ProcessSecMsg>_0`:
   \   00000C   04           DB        4
   \   00000D   08           DB        8
   \   00000E   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000010   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000012   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000014   ....         DW        ??ZDApp_ProcessSecMsg_1
   \   000016   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000018   ....         DW        ??ZDApp_ProcessSecMsg_2
   \   00001A   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   00001C   ....         DW        ??ZDApp_ProcessSecMsg_3
   \   00001E   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000020   ....         DW        ??ZDApp_ProcessSecMsg_0
   1298            {
   1299              case ZDO_ESTABLISH_KEY_CFM:
   1300                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1301                {
   1302                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1303                }
   1304                break;
   1305          
   1306              case ZDO_ESTABLISH_KEY_IND:
   1307                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1308                {
   1309                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1310                  {
   1311                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1312                  }
   1313                }
   1314                break;
   1315          
   1316              case ZDO_TRANSPORT_KEY_IND:
   1317                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   000022   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000025   E0           MOVX    A,@DPTR
   \   000026   6401         XRL     A,#0x1
   \   000028   6005         JZ      ??ZDApp_ProcessSecMsg_4
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   6402         XRL     A,#0x2
   \   00002D   7022         JNZ     ??ZDApp_ProcessSecMsg_0
   1318                {
   1319                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   00002F                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   00002F   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   \   000032   801D         SJMP    ??ZDApp_ProcessSecMsg_0
   1320                }
   1321                break;
   1322          
   1323              case ZDO_UPDATE_DEVICE_IND:
   1324                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1325                {
   1326                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1327                }
   1328                break;
   1329          
   1330              case ZDO_REMOVE_DEVICE_IND:
   1331                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000034   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6401         XRL     A,#0x1
   \   00003A   7015         JNZ     ??ZDApp_ProcessSecMsg_0
   1332                {
   1333                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   \   00003C                ; Setup parameters for call to function ZDSecMgrRemoveDeviceInd
   \   00003C   12....       LCALL   ??ZDSecMgrRemoveDeviceInd?relay
   \   00003F   8010         SJMP    ??ZDApp_ProcessSecMsg_0
   1334                }
   1335                break;
   1336          
   1337              case ZDO_REQUEST_KEY_IND:
   1338                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1339                {
   1340                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1341                  {
   1342                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1343                  }
   1344                }
   1345                break;
   1346          
   1347              case ZDO_SWITCH_KEY_IND:
   1348                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000041   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000044   E0           MOVX    A,@DPTR
   \   000045   6401         XRL     A,#0x1
   \   000047   6005         JZ      ??ZDApp_ProcessSecMsg_5
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   6402         XRL     A,#0x2
   \   00004C   7003         JNZ     ??ZDApp_ProcessSecMsg_0
   1349                {
   1350                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_5:
   \   00004E                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   00004E   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1351                }
   1352                break;
   1353          
   1354              case ZDO_AUTHENTICATE_IND:
   1355                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1356                {
   1357                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1358                }
   1359                break;
   1360          
   1361              case ZDO_AUTHENTICATE_CFM:
   1362                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1363                {
   1364                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1365                }
   1366                break;
   1367          
   1368              default:
   1369                // Unsupported messages
   1370                break;
   1371            }
   1372          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000051   02....       LJMP    ?Subroutine2 & 0xFFFF
   1373          
   1374          /*********************************************************************
   1375           * @fn      ZDApp_ProcessNetworkJoin()
   1376           *
   1377           * @brief
   1378           *
   1379           *   Save off the Network key information.
   1380           *
   1381           * @param   none
   1382           *
   1383           * @return  none
   1384           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1385          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1386          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1387            if ( (devState == DEV_NWK_JOINING) ||
   1388                ((devState == DEV_NWK_ORPHAN)  &&
   1389                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1390            {
   1391              // Result of a Join attempt by this device.
   1392              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   703A         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1393              {
   1394                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine13 & 0xFFFF
   1395          
   1396          #if defined ( POWER_SAVING )
   1397                osal_pwrmgr_device( PWRMGR_BATTERY );
   1398          #endif
   1399          
   1400                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1401                {
   1402                  // wait for auth from trust center!!
   1403                  devState = DEV_END_DEVICE_UNAUTH;
   1404          
   1405                  // Start the reset timer for MAX UNAUTH time
   1406                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1407                }
   1408                else
   1409                {
   1410                  if ( ZSTACK_ROUTER_BUILD )
   1411                  {
   1412                    if ( devState == DEV_NWK_ORPHAN
   1413                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_42:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   640A         XRL     A,#0xa
   \   000036   700D         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   000038   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00003B   6010         JZ      ??ZDApp_ProcessNetworkJoin_5
   1414                    {
   1415                      // Change NIB state to router for restore
   1416                      _NIB.nwkState = NWK_ROUTER;
   \   00003D   7408         MOV     A,#0x8
   \   00003F   90....       MOV     DPTR,#(_NIB + 35)
   \   000042   F0           MOVX    @DPTR,A
   \   000043   8008         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1417                    }
   1418                  }
   1419          
   1420                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000045   E0           MOVX    A,@DPTR
   \   000046   6403         XRL     A,#0x3
   \   000048   7003         JNZ     ??ZDApp_ProcessNetworkJoin_5
   1421                  {
   1422                    ZDApp_AnnounceNewAddress();
   \   00004A                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00004A   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1423                  }
   1424          
   1425                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00004D   7406         MOV     A,#0x6
   \   00004F   90....       MOV     DPTR,#devState
   \   000052   F0           MOVX    @DPTR,A
   1426                  if ( ZSTACK_ROUTER_BUILD )
   1427                  {
   1428                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1429                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000053   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000056   7003         JNZ     $+5
   \   000058   02....       LJMP    ??CrossCallReturnLabel_31 & 0xFFFF
   1430                    {
   1431                      NLME_StartRouterRequest( 0, 0, false );
   \   00005B                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00005B   7B00         MOV     R3,#0x0
   \   00005D   7A00         MOV     R2,#0x0
   \   00005F   7900         MOV     R1,#0x0
   \   000061   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000064   02....       LJMP    ??CrossCallReturnLabel_31 & 0xFFFF
   1432                    }
   1433                  }
   1434                }
   1435              }
   1436              else
   1437              {
   1438                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000067   90....       MOV     DPTR,#devStartMode
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6401         XRL     A,#0x1
   \   00006D   7031         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   00006F   90....       MOV     DPTR,#retryCnt
   \   000072   E0           MOVX    A,@DPTR
   \   000073   04           INC     A
   \   000074   F0           MOVX    @DPTR,A
   \   000075   C3           CLR     C
   \   000076   9403         SUBB    A,#0x3
   \   000078   4026         JC      ??ZDApp_ProcessNetworkJoin_6
   1439                {
   1440                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00007A   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   00007D   7003         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00007F   74FF         MOV     A,#-0x1
   \   000081   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   000082   600A         JZ      ??ZDApp_ProcessNetworkJoin_8
   \   000084   74FE         MOV     A,#-0x2
   \   000086   68           XRL     A,R0
   \   000087   7003         JNZ     ??ZDApp_ProcessNetworkJoin_9
   \   000089   74FF         MOV     A,#-0x1
   \   00008B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   00008C   7006         JNZ     ??ZDApp_ProcessNetworkJoin_10
   1441                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   00008E   E4           CLR     A
   \   00008F   90....       MOV     DPTR,#devStartMode
   \   000092   800B         SJMP    ??ZDApp_ProcessNetworkJoin_11
   1442                  else
   1443                  {
   1444                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   000094   7403         MOV     A,#0x3
   \   000096   90....       MOV     DPTR,#devStartMode
   \   000099   F0           MOVX    @DPTR,A
   1445                    _tmpRejoinState = true;
   \   00009A   7401         MOV     A,#0x1
   \   00009C   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   00009F   F0           MOVX    @DPTR,A
   1446                  }
   1447                }
   1448          
   1449                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1450                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   0000A0                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000A0   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000A3   8A..         MOV     ?V0 + 0,R2
   \   0000A5   8B..         MOV     ?V0 + 1,R3
   \   0000A7   74FE         MOV     A,#-0x2
   \   0000A9   65..         XRL     A,?V0 + 0
   \   0000AB   7004         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   0000AD   74FF         MOV     A,#-0x1
   \   0000AF   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000B1   700E         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000B3   90....       MOV     DPTR,#(_NIB + 20)
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   64FE         XRL     A,#0xfe
   \   0000B9   7004         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000BF   6026         JZ      ??ZDApp_ProcessNetworkJoin_15
   1451                {
   1452                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000C1   85..82       MOV     DPL,?XSP + 0
   \   0000C4   85..83       MOV     DPH,?XSP + 1
   \   0000C7   74FE         MOV     A,#-0x2
   \   0000C9   F0           MOVX    @DPTR,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   74FF         MOV     A,#-0x1
   \   0000CD   F0           MOVX    @DPTR,A
   1453                  // Invalidate nwk addr so end device does not use in its data reqs.
   1454                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000CE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000D1   74FE         MOV     A,#-0x2
   \   0000D3   F0           MOVX    @DPTR,A
   \   0000D4   A3           INC     DPTR
   \   0000D5   74FF         MOV     A,#-0x1
   \   0000D7   F0           MOVX    @DPTR,A
   1455                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000D8                ; Setup parameters for call to function ZMacSetReq
   \   0000D8   85..82       MOV     DPL,?XSP + 0
   \   0000DB   85..83       MOV     DPH,?XSP + 1
   \   0000DE   AA82         MOV     R2,DPL
   \   0000E0   AB83         MOV     R3,DPH
   \   0000E2   7953         MOV     R1,#0x53
   \   0000E4   12....       LCALL   ??ZMacSetReq?relay
   1456                }
   1457          
   1458                // Clear the neighbor Table and network discovery tables.
   1459                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000E7                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000E7   12....       LCALL   ??nwkNeighborInitTable?relay
   1460                NLME_NwkDiscTerm();
   \   0000EA                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000EA   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1461          
   1462                zdoDiscCounter = 1;
   \   0000ED   7401         MOV     A,#0x1
   \   0000EF   90....       MOV     DPTR,#zdoDiscCounter
   \   0000F2   F0           MOVX    @DPTR,A
   1463          
   1464          //      ZDApp_NetworkInit( (uint16)
   1465          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1466          //                          (NWK_START_DELAY * 5)) );
   1467                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1468                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000F3                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000F3                ; Setup parameters for call to function osal_rand
   \   0000F3   8075         SJMP    ??ZDApp_ProcessNetworkJoin_16
   1469              }
   1470            }
   1471            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000F5   E0           MOVX    A,@DPTR
   \   0000F6   6404         XRL     A,#0x4
   \   0000F8   7073         JNZ     ??CrossCallReturnLabel_31
   1472            {
   1473              // results of an orphaning attempt by this device
   1474              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000FA   90....       MOV     DPTR,#nwkStatus
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   7021         JNZ     ??ZDApp_ProcessNetworkJoin_17
   1475              {
   1476                if ( ZG_SECURE_ENABLED )
   1477                {
   1478                  ZDApp_RestoreNwkKey();
   1479                }
   1480          
   1481                devState = DEV_END_DEVICE;
   \   000100   12....       LCALL   ?Subroutine8 & 0xFFFF
   1482                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1483                // setup Power Manager Device
   1484          #if defined ( POWER_SAVING )
   1485                osal_pwrmgr_device( PWRMGR_BATTERY );
   1486          #endif
   1487          
   1488                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_1:
   \   000103   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000106   E0           MOVX    A,@DPTR
   \   000107   A2E3         MOV     C,0xE0 /* A   */.3
   \   000109   5003         JNC     ??CrossCallReturnLabel_33
   1489                {
   1490                  // The receiver is on, turn network layer polling off.
   1491                  NLME_SetPollRate( 0 );
   \   00010B                ; Setup parameters for call to function NLME_SetPollRate
   \   00010B   12....       LCALL   ?Subroutine23 & 0xFFFF
   1492                  NLME_SetQueuedPollRate( 0 );
   1493                  NLME_SetResponseRate( 0 );
   1494                }
   1495          
   1496                if ( ZSTACK_ROUTER_BUILD )
   1497                {
   1498                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1499                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_33:
   \   00010E   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000111   6009         JZ      ??ZDApp_ProcessNetworkJoin_18
   1500                  {
   1501                    NLME_StartRouterRequest( 0, 0, false );
   \   000113                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000113   7B00         MOV     R3,#0x0
   \   000115   7A00         MOV     R2,#0x0
   \   000117   7900         MOV     R1,#0x0
   \   000119   12....       LCALL   ??NLME_StartRouterRequest?relay
   1502                  }
   1503                }
   1504          
   1505                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   00011C                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00011C   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   00011F   804C         SJMP    ??CrossCallReturnLabel_31
   1506              }
   1507              else
   1508              {
   1509                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000121   90....       MOV     DPTR,#devStartMode
   \   000124   E0           MOVX    A,@DPTR
   \   000125   6401         XRL     A,#0x1
   \   000127   703B         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1510                {
   1511                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   000129   90....       MOV     DPTR,#retryCnt
   \   00012C   E0           MOVX    A,@DPTR
   \   00012D   04           INC     A
   \   00012E   F0           MOVX    @DPTR,A
   \   00012F   C3           CLR     C
   \   000130   9404         SUBB    A,#0x4
   \   000132   5028         JNC     ??ZDApp_ProcessNetworkJoin_20
   1512                  {
   1513                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000134   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000137   7003         JNZ     ??ZDApp_ProcessNetworkJoin_21
   \   000139   74FF         MOV     A,#-0x1
   \   00013B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   00013C   600A         JZ      ??ZDApp_ProcessNetworkJoin_22
   \   00013E   74FE         MOV     A,#-0x2
   \   000140   68           XRL     A,R0
   \   000141   7003         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   000143   74FF         MOV     A,#-0x1
   \   000145   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   000146   7007         JNZ     ??ZDApp_ProcessNetworkJoin_24
   1514                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   000148   E4           CLR     A
   \   000149   90....       MOV     DPTR,#devStartMode
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   00014C   F0           MOVX    @DPTR,A
   \   00014D   8015         SJMP    ??ZDApp_ProcessNetworkJoin_19
   1515                    else
   1516                    {
   1517                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   00014F   7403         MOV     A,#0x3
   \   000151   90....       MOV     DPTR,#devStartMode
   \   000154   F0           MOVX    @DPTR,A
   1518                      _tmpRejoinState = true;
   \   000155   7401         MOV     A,#0x1
   \   000157   90....       MOV     DPTR,#_tmpRejoinState
   \   00015A   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_25
   1519                    }
   1520                  }
   1521                  // Do a normal join to the network after certain times of rejoin retries
   1522                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   00015C   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   00015F   E0           MOVX    A,@DPTR
   \   000160   6401         XRL     A,#0x1
   \   000162   60E4         JZ      ??ZDApp_ProcessNetworkJoin_22
   1523                  {
   1524                    devStartMode = MODE_JOIN;
   1525                  }
   1526                }
   1527          
   1528                // Clear the neighbor Table and network discovery tables.
   1529                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000164                ; Setup parameters for call to function nwkNeighborInitTable
   \   000164   12....       LCALL   ??nwkNeighborInitTable?relay
   1530                NLME_NwkDiscTerm();
   \   000167                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   000167   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1531          
   1532                // setup a retry for later...
   1533                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1534                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   00016A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00016A                ; Setup parameters for call to function osal_rand
   1535              }
   1536            }
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   00016A   12....       LCALL   ?Subroutine22 & 0xFFFF
   1537          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1538            else
   1539            {
   1540              // Assume from address conflict
   1541              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1542              {
   1543                // Notify the network
   1544                ZDApp_AnnounceNewAddress();
   1545          
   1546                // Notify apps
   1547                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1548              }
   1549            }
   1550          #endif
   1551          }
   \                     ??CrossCallReturnLabel_31:
   \   00016D   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   90....       MOV     DPTR,#(_NIB + 33)
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   68           XRL     A,R0
   \   00000B   22           RET
   1552          
   1553          /*********************************************************************
   1554           * @fn      ZDApp_SaveNwkKey()
   1555           *
   1556           * @brief   Save off the Network key information.
   1557           *
   1558           * @param   none
   1559           *
   1560           * @return  none
   1561           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1562          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1563          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1564            nwkActiveKeyItems keyItems;
   1565          
   1566            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1567            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1568          
   1569            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1570                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1571          
   1572            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1573          
   1574            // Clear copy in RAM before return.
   1575            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \   000052                ; Setup parameters for call to function osal_memset
   \   000052   7C15         MOV     R4,#0x15
   \   000054   FD           MOV     R5,A
   \   000055   F9           MOV     R1,A
   \   000056   85..82       MOV     DPL,?XSP + 0
   \   000059   85..83       MOV     DPH,?XSP + 1
   \   00005C   AA82         MOV     R2,DPL
   \   00005E   AB83         MOV     R3,DPH
   \   000060   12....       LCALL   ??osal_memset?relay
   1576          
   1577          }
   \   000063                REQUIRE ?Subroutine4
   \   000063                ; // Fall through to label ?Subroutine4

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine27:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine31_0
   \   000006                ; // Fall through to label ??Subroutine31_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine31_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1578          
   1579          /*********************************************************************
   1580           * @fn      ZDApp_ResetNwkKey()
   1581           *
   1582           * @brief   Reset the Network key information in NV.
   1583           *
   1584           * @param   none
   1585           *
   1586           * @return  none
   1587           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1588          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1589          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1590            nwkActiveKeyItems keyItems;
   1591          
   1592            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine24 & 0xFFFF
   1593            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1594                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_35:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1595          }
   \   000023   02....       LJMP    ?Subroutine7 & 0xFFFF
   1596          
   1597          /*********************************************************************
   1598           * @fn      ZDApp_RestoreNwkKey()
   1599           *
   1600           * @brief
   1601           *
   1602           *   Save off the Network key information.
   1603           *
   1604           * @param   none
   1605           *
   1606           * @return  true if restored from NV, false if not
   1607           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1608          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1609          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1610            nwkActiveKeyItems keyItems;
   1611            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1612          
   1613            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1614                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   704B         JNZ     ??ZDApp_RestoreNwkKey_0
   1615            {
   1616              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   C082         PUSH    DPL
   \   000041   C083         PUSH    DPH
   \   000043   90....       MOV     DPTR,#__Constant_0
   \   000046   78..         MOV     R0,#?V0 + 0
   \   000048   12....       LCALL   ?L_MOV_X
   \   00004B   D083         POP     DPH
   \   00004D   D082         POP     DPL
   \   00004F   78..         MOV     R0,#?V0 + 0
   \   000051   12....       LCALL   ?L_EQ_X
   \   000054   6025         JZ      ??ZDApp_RestoreNwkKey_1
   1617              {
   1618                // Restore the key information
   1619                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   \   000056   90....       MOV     DPTR,#__Constant_3e8
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_X
   \   00005E   7411         MOV     A,#0x11
   \   000060   12....       LCALL   ?XSTACK_DISP0_8
   \   000063   78..         MOV     R0,#?V0 + 0
   \   000065   12....       LCALL   ?L_ADD_TO_X
   1620                nwkFrameCounter = keyItems.frameCounter;
   \   000068   7411         MOV     A,#0x11
   \   00006A   12....       LCALL   ?XSTACK_DISP0_8
   \   00006D   78..         MOV     R0,#?V0 + 0
   \   00006F   12....       LCALL   ?L_MOV_X
   \   000072   90....       MOV     DPTR,#nwkFrameCounter
   \   000075   78..         MOV     R0,#?V0 + 0
   \   000077   12....       LCALL   ?L_MOV_TO_X
   1621                ret = true;
   \   00007A   0E           INC     R6
   1622              }
   1623          
   1624              // Force a save for the first frame counter increment
   1625              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00007B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00007E   74E9         MOV     A,#-0x17
   \   000080   F0           MOVX    @DPTR,A
   \   000081   A3           INC     DPTR
   \   000082   7403         MOV     A,#0x3
   \   000084   F0           MOVX    @DPTR,A
   1626            }
   1627            // Clear copy in RAM before return.
   1628            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000085                ; Setup parameters for call to function osal_memset
   \   000085   7C15         MOV     R4,#0x15
   \   000087   7D00         MOV     R5,#0x0
   \   000089   7900         MOV     R1,#0x0
   \   00008B   85..82       MOV     DPL,?XSP + 0
   \   00008E   85..83       MOV     DPH,?XSP + 1
   \   000091   AA82         MOV     R2,DPL
   \   000093   AB83         MOV     R3,DPH
   \   000095   12....       LCALL   ??osal_memset?relay
   1629          
   1630            return ( ret );
   \   000098   EE           MOV     A,R6
   \   000099   F9           MOV     R1,A
   \   00009A   02....       LJMP    ?Subroutine4 & 0xFFFF
   1631          }
   1632          
   1633          /*********************************************************************
   1634           * @fn      ZDApp_ResetTimerStart
   1635           *
   1636           * @brief   Start the reset timer.
   1637           *
   1638           * @param   delay - delay time(ms) before reset
   1639           *
   1640           * @return  none
   1641           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1642          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1643          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1644            // Start the rest timer
   1645            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine15 & 0xFFFF
   1646          }
   \                     ??CrossCallReturnLabel_56:
   \   00000D   02....       LJMP    ?Subroutine2 & 0xFFFF
   1647          
   1648          /*********************************************************************
   1649           * @fn      ZDApp_ResetTimerCancel
   1650           *
   1651           * @brief   Cancel the reset timer.
   1652           *
   1653           * @param   none
   1654           *
   1655           * @return  none
   1656           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1657          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1658          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1659            // Cancel the reset timer
   1660            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1661          }
   \   000010   02....       LJMP    ?Subroutine2 & 0xFFFF
   1662          
   1663          /*********************************************************************
   1664           * @fn      ZDApp_LeaveCtrlInit
   1665           *
   1666           * @brief   Initialize the leave control logic.
   1667           *
   1668           * @param   none
   1669           *
   1670           * @return  none
   1671           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1672          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1673          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1674            uint8 status;
   1675          
   1676          
   1677            // Initialize control state
   1678            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine11 & 0xFFFF
   1679          
   1680            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1681                                        sizeof(ZDApp_LeaveCtrl),
   1682                                        &ZDApp_LeaveCtrl );
   1683          
   1684            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_4:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1685            {
   1686              // Read saved control
   1687              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1688                            0,
   1689                            sizeof( uint8 ),
   1690                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1691            }
   1692          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine36_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   E4           CLR     A
   \   000001   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000008   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1693          
   1694          /*********************************************************************
   1695           * @fn      ZDApp_LeaveCtrlSet
   1696           *
   1697           * @brief   Set the leave control logic.
   1698           *
   1699           * @param   ra - reassociate flag
   1700           *
   1701           * @return  none
   1702           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1703          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1704          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1705            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   7401         MOV     A,#0x1
   \   000009   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000C   F0           MOVX    @DPTR,A
   1706          
   1707            if ( ra == TRUE )
   \   00000D   6E           XRL     A,R6
   \   00000E   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1708            {
   1709              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   1710            }
   1711          
   1712            // Write the leave control
   1713            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1714                           0,
   1715                           sizeof( uint8 ),
   1716                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000013                ; Setup parameters for call to function osal_nv_write
   \   000013   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000016   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000019   78..         MOV     R0,#?V0 + 0
   \   00001B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001E   75..01       MOV     ?V0 + 0,#0x1
   \   000021   75..00       MOV     ?V0 + 1,#0x0
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000029   7C00         MOV     R4,#0x0
   \   00002B   7D00         MOV     R5,#0x0
   \   00002D   7A85         MOV     R2,#-0x7b
   \   00002F   12....       LCALL   ??Subroutine31_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000032   02....       LJMP    ??Subroutine35_0 & 0xFFFF
   1717          }
   1718          
   1719          /*********************************************************************
   1720           * @fn      ZDApp_LeaveCtrlBypass
   1721           *
   1722           * @brief   Check if NV restore should be skipped during a leave reset.
   1723           *
   1724           * @param   none
   1725           *
   1726           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1727           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1728          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1729          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1730            uint8 bypass;
   1731          
   1732            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1733            {
   1734              bypass = TRUE;
   1735            }
   1736            else
   1737            {
   1738              bypass = FALSE;
   1739            }
   1740          
   1741            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E                REQUIRE ?Subroutine2
   \   00000E                ; // Fall through to label ?Subroutine2
   1742          }
   1743          
   1744          /*********************************************************************
   1745           * @fn      ZDApp_LeaveCtrlStartup
   1746           *
   1747           * @brief   Check for startup conditions during a leave reset.
   1748           *
   1749           * @param   state      - devState_t determined by leave control logic
   1750           * @param   startDelay - startup delay
   1751           *
   1752           * @return  none
   1753           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1754          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1755          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1756            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1757          
   1758            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1759            {
   1760              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1761              {
   1762                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1763              }
   1764              else
   1765              {
   1766                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   E4           CLR     A
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1767              }
   1768          
   1769              // Set leave control to initialized state
   1770              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine11 & 0xFFFF
   1771          
   1772              // Write initialized control
   1773              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1774                            0,
   1775                            sizeof( uint8 ),
   1776                            &ZDApp_LeaveCtrl);
   1777            }
   \                     ??CrossCallReturnLabel_5:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine31_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_54:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1778          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine36_0 & 0xFFFF
   1779          
   1780          /*********************************************************************
   1781           * @fn      ZDApp_LeaveReset
   1782           *
   1783           * @brief   Setup a device reset due to a leave indication/confirm.
   1784           *
   1785           * @param   ra - reassociate flag
   1786           *
   1787           * @return  none
   1788           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1789          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1790          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1791            ZDApp_LeaveCtrlSet( ra );
   \   000005                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000005   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1792          
   1793            ZDApp_ResetTimerStart( 5000 );
   \   000008                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000008   7A88         MOV     R2,#-0x78
   \   00000A   7B13         MOV     R3,#0x13
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1794          }
   \   00000F   80..         SJMP    ??Subroutine33_0
   1795          
   1796          /*********************************************************************
   1797           * @fn      ZDApp_LeaveUpdate
   1798           *
   1799           * @brief   Update local device data related to leaving device.
   1800           *
   1801           * @param   nwkAddr        - NWK address of leaving device
   1802           * @param   extAddr        - EXT address of leaving device
   1803           * @param   removeChildren - remove children of leaving device
   1804           *
   1805           * @return  none
   1806           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1807          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1808                                  uint8 removeChildren )
   1809          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EC           MOV     A,R4
   \   000006   FA           MOV     R2,A
   \   000007   ED           MOV     A,R5
   \   000008   FB           MOV     R3,A
   1810            /*
   1811            AddrMgrEntry_t entry;
   1812            */
   1813            (void)nwkAddr;  // Intentionally unreferenced parameter
   1814          
   1815            // Remove if child
   1816            if ( ZSTACK_ROUTER_BUILD )
   1817            {
   1818              NLME_RemoveChild( extAddr, removeChildren );
   \   000009                ; Setup parameters for call to function NLME_RemoveChild
   \   000009   12....       LCALL   ??NLME_RemoveChild?relay
   1819            }
   1820          
   1821            /*
   1822            // Set NWK address to invalid
   1823            entry.user    = ADDRMGR_USER_DEFAULT;
   1824            entry.nwkAddr = INVALID_NODE_ADDR;
   1825            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1826            AddrMgrEntryUpdate( &entry );
   1827          
   1828            // Check
   1829            if ( removeChildren == TRUE )
   1830            {
   1831              // Set index to INVALID_NODE_ADDR to start search
   1832              entry.index = INVALID_NODE_ADDR;
   1833          
   1834              // Get first entry
   1835              AddrMgrEntryGetNext( &entry );
   1836          
   1837              // Remove all descendents
   1838              while ( entry.index != INVALID_NODE_ADDR )
   1839              {
   1840                // Check NWK address allocation algorithm
   1841                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1842                {
   1843                  // Set NWK address to invalid
   1844                  entry.nwkAddr = INVALID_NODE_ADDR;
   1845                  AddrMgrEntryUpdate( &entry );
   1846                }
   1847          
   1848                // Get next entry
   1849                AddrMgrEntryGetNext( &entry );
   1850              }
   1851            }
   1852            */
   1853          }
   \   00000C   80..         SJMP    ??Subroutine33_0
   1854          
   1855          /*********************************************************************
   1856           * CALLBACK FUNCTIONS
   1857           */
   1858          
   1859          
   1860          /*********************************************************************
   1861           * @fn      ZDApp_SendEventMsg()
   1862           *
   1863           * @brief
   1864           *
   1865           *   Sends a Network Join message
   1866           *
   1867           * @param  cmd - command ID
   1868           * @param  len - length (in bytes) of the buf field
   1869           * @param  buf - buffer for the rest of the message.
   1870           *
   1871           * @return  none
   1872           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1873          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1874          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   1875            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000008                ; Setup parameters for call to function ZDApp_SendMsg
   \   000008   FB           MOV     R3,A
   \   000009   EE           MOV     A,R6
   \   00000A   FA           MOV     R2,A
   \   00000B                REQUIRE ?Subroutine5
   \   00000B                ; // Fall through to label ?Subroutine5
   1876          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000003   80..         SJMP    ??Subroutine33_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1877          
   1878          /*********************************************************************
   1879           * @fn      ZDApp_SendMsg()
   1880           *
   1881           * @brief   Sends a OSAL message
   1882           *
   1883           * @param  taskID - Where to send the message
   1884           * @param  cmd - command ID
   1885           * @param  len - length (in bytes) of the buf field
   1886           * @param  buf - buffer for the rest of the message.
   1887           *
   1888           * @return  none
   1889           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1890          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1891          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   8A..         MOV     ?V0 + 6,R2
   \   000009   8B..         MOV     ?V0 + 5,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1892            osal_event_hdr_t *msgPtr;
   1893          
   1894            // Send the address to the task
   1895            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014                ; Setup parameters for call to function osal_msg_allocate
   \   000014   AA..         MOV     R2,?V0 + 0
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_msg_allocate?relay
   \   00001B   8A..         MOV     ?V0 + 8,R2
   \   00001D   8B..         MOV     ?V0 + 9,R3
   \   00001F   AE..         MOV     R6,?V0 + 8
   \   000021   AF..         MOV     R7,?V0 + 9
   1896            if ( msgPtr )
   \   000023   EE           MOV     A,R6
   \   000024   7001         JNZ     ??ZDApp_SendMsg_0
   \   000026   EF           MOV     A,R7
   \                     ??ZDApp_SendMsg_0:
   \   000027   6036         JZ      ??ZDApp_SendMsg_1
   1897            {
   1898              if ( (len > 0) && (buf != NULL) )
   \   000029   E5..         MOV     A,?V0 + 5
   \   00002B   6022         JZ      ??ZDApp_SendMsg_2
   \   00002D   E5..         MOV     A,?V0 + 2
   \   00002F   7002         JNZ     ??ZDApp_SendMsg_3
   \   000031   E5..         MOV     A,?V0 + 3
   \                     ??ZDApp_SendMsg_3:
   \   000033   601A         JZ      ??ZDApp_SendMsg_2
   1899                osal_memcpy( msgPtr, buf, len );
   \   000035                ; Setup parameters for call to function osal_memcpy
   \   000035   85....       MOV     ?V0 + 8,?V0 + 2
   \   000038   85....       MOV     ?V0 + 9,?V0 + 3
   \   00003B   75..00       MOV     ?V0 + 10,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 8
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000043   AC..         MOV     R4,?V0 + 0
   \   000045   7D00         MOV     R5,#0x0
   \   000047   12....       LCALL   ??osal_memcpy?relay
   \   00004A   7403         MOV     A,#0x3
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   1900          
   1901              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E5..         MOV     A,?V0 + 6
   \   000055   F0           MOVX    @DPTR,A
   1902              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000056                ; Setup parameters for call to function osal_msg_send
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   EF           MOV     A,R7
   \   000059   FB           MOV     R3,A
   \   00005A   A9..         MOV     R1,?V0 + 4
   \   00005C   12....       LCALL   ??osal_msg_send?relay
   1903            }
   1904          }
   \                     ??ZDApp_SendMsg_1:
   \   00005F   7F0B         MOV     R7,#0xb
   \   000061   02....       LJMP    ?BANKED_LEAVE_XDATA
   1905          
   1906          /*********************************************************************
   1907           * Call Back Functions from NWK  - API
   1908           */
   1909          
   1910          /*********************************************************************
   1911           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1912           *
   1913           * @brief       This function returns a choice of PAN to join.
   1914           *
   1915           * @param       ResultCount - Number of routers discovered
   1916           * @param               NetworkList - Pointer to list of network descriptors
   1917           *
   1918           * @return      ZStatus_t
   1919           */
   1920          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1921          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1922                                                   networkDesc_t *NetworkList )
   1923          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 6,R1
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   1924            networkDesc_t *pNwkDesc = NetworkList;
   1925            ZDO_NetworkDiscoveryCfm_t msg;
   1926            uint8 i = ResultCount;
   1927            uint8 stackProfile;
   1928            uint8 stackProfilePro;
   1929            uint8 selected;
   1930          
   1931          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1932            if ( zdappMgmtNwkDiscReqInProgress )
   1933            {
   1934              zdappMgmtNwkDiscReqInProgress = false;
   1935              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1936              return ( ZSuccess );
   1937            }
   1938          #endif
   1939          
   1940            // process discovery results
   1941            stackProfilePro = FALSE;
   \   000010   75..00       MOV     ?V0 + 8,#0x0
   1942            selected = FALSE;
   1943          
   1944            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000013   75..00       MOV     ?V0 + 7,#0x0
   1945            {
   1946              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000016   AE..         MOV     R6,?V0 + 4
   \   000018   AF..         MOV     R7,?V0 + 5
   1947              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00001A   75..00       MOV     ?V0 + 9,#0x0
   \   00001D   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1948              {
   1949                if ( zgConfigPANID != 0xFFFF )
   1950                {
   1951                  // PAN Id is preconfigured. check if it matches
   1952                  if ( pNwkDesc->panId != zgConfigPANID )
   1953                    continue;
   1954                }
   1955          
   1956          
   1957                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true )
   1958                {
   1959                  // If the extended Pan ID is commissioned to a non zero value
   1960                  // Only join the Pan that has match EPID
   1961                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1962                    continue;
   1963          
   1964                }
   1965          
   1966          
   1967                  // check that network is allowing joining
   1968                  if ( ZSTACK_ROUTER_BUILD )
   1969                  {
   1970                    if ( stackProfilePro == FALSE )
   1971                    {
   1972                      if ( !pNwkDesc->routerCapacity )
   1973                      {
   1974                        continue;
   1975                      }
   1976                    }
   1977                    else
   1978                    {
   1979                      if ( !pNwkDesc->deviceCapacity )
   1980                      {
   1981                        continue;
   1982                      }
   1983                    }
   1984                  }
   1985                  else if ( ZSTACK_END_DEVICE_BUILD )
   1986                  {
   1987                    if ( !pNwkDesc->deviceCapacity )
   1988                    {
   1989                      continue;
   1990                    }
   1991                  }
   1992          
   1993                  // check version of zigbee protocol
   1994                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1995                    continue;
   1996          
   1997                  // check version of stack profile
   1998                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1999                  {
   2000                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   2001                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   6402         XRL     A,#0x2
   \   000022   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000024   7401         MOV     A,#0x1
   \   000026   6A           XRL     A,R2
   \   000027   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   2002                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000029   75..01       MOV     ?V0 + 8,#0x1
   2003          
   2004                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00002C   E5..         MOV     A,?V0 + 7
   \   00002E   6003         JZ      $+5
   \   000030   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000033   05..         INC     ?V0 + 9
   \   000035   EE           MOV     A,R6
   \   000036   2416         ADD     A,#0x16
   \   000038   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_60:
   \   00003B   FE           MOV     R6,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00003F   EE           MOV     A,R6
   \   000040   2407         ADD     A,#0x7
   \   000042   F5..         MOV     ?V0 + 0,A
   \   000044   EF           MOV     A,R7
   \   000045   3400         ADDC    A,#0x0
   \   000047   F5..         MOV     ?V0 + 1,A
   \   000049   EE           MOV     A,R6
   \   00004A   240D         ADD     A,#0xd
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   EF           MOV     A,R7
   \   00004F   3400         ADDC    A,#0x0
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   E5..         MOV     A,?V0 + 9
   \   000055   C3           CLR     C
   \   000056   95..         SUBB    A,?V0 + 6
   \   000058   4003         JC      $+5
   \   00005A   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   00005D   90....       MOV     DPTR,#zgConfigPANID
   \   000060   E0           MOVX    A,@DPTR
   \   000061   64FF         XRL     A,#0xff
   \   000063   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000069   6013         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   00006B   8E82         MOV     DPL,R6
   \   00006D   8F83         MOV     DPH,R7
   \   00006F   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000072   90....       MOV     DPTR,#zgConfigPANID
   \   000075   E0           MOVX    A,@DPTR
   \   000076   68           XRL     A,R0
   \   000077   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   000079   A3           INC     DPTR
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00007C   70B5         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   00007E                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   00007E   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000080   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000082   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000085   E9           MOV     A,R1
   \   000086   6401         XRL     A,#0x1
   \   000088   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   00008A                ; Setup parameters for call to function sAddrExtCmp
   \   00008A   AC..         MOV     R4,?V0 + 2
   \   00008C   AD..         MOV     R5,?V0 + 3
   \   00008E   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000090   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000092   12....       LCALL   ??sAddrExtCmp?relay
   \   000095   E9           MOV     A,R1
   \   000096   609B         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   000098   E5..         MOV     A,?V0 + 8
   \   00009A   8E82         MOV     DPL,R6
   \   00009C   8F83         MOV     DPH,R7
   \   00009E   A3           INC     DPTR
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   7005         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_12
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   7006         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_13
   \   0000A8   8089         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000AA   A3           INC     DPTR
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   6085         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   0000AE   85..82       MOV     DPL,?V0 + 0
   \   0000B1   85..83       MOV     DPH,?V0 + 1
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   FA           MOV     R2,A
   \   0000B6   90....       MOV     DPTR,#(_NIB + 17)
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   6A           XRL     A,R2
   \   0000BB   6003         JZ      $+5
   \   0000BD   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   \   0000C0   8E82         MOV     DPL,R6
   \   0000C2   8F83         MOV     DPH,R7
   \   0000C4   A3           INC     DPTR
   \   0000C5   A3           INC     DPTR
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   FA           MOV     R2,A
   \   0000CE   90....       MOV     DPTR,#zgStackProfile
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   6A           XRL     A,R2
   \   0000D3   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000D5   E0           MOVX    A,@DPTR
   \   0000D6   6401         XRL     A,#0x1
   \   0000D8   6003         JZ      $+5
   \   0000DA   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000DD   7402         MOV     A,#0x2
   \   0000DF   6A           XRL     A,R2
   \   0000E0   6003         JZ      $+5
   \   0000E2   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000E5   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   2005                    {
   2006                      continue;
   2007                    }
   2008                  }
   2009          
   2010                // check if beacon order is the right value..
   2011                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   2012                //    continue;
   2013          
   2014                // choose this pan for joining
   2015                break;
   2016              }
   2017              if (i < ResultCount)
   2018              {
   2019               selected = TRUE;
   2020                break;
   2021              }
   2022          
   2023              // break if selected or stack profile pro wasn't found
   2024              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000E8   E5..         MOV     A,?V0 + 8
   \   0000EA   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_14
   2025              {
   2026                break;
   2027              }
   2028            }
   \   0000EC   05..         INC     ?V0 + 7
   \   0000EE   E5..         MOV     A,?V0 + 7
   \   0000F0   C3           CLR     C
   \   0000F1   9402         SUBB    A,#0x2
   \   0000F3   5003         JNC     $+5
   \   0000F5   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   2029          
   2030            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_14:
   \   0000F8   E5..         MOV     A,?V0 + 6
   \   0000FA   65..         XRL     A,?V0 + 9
   \   0000FC   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   2031            {
   2032              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   0000FE   7401         MOV     A,#0x1
   \   000100   12....       LCALL   ?XSTACK_DISP0_8
   \   000103   7401         MOV     A,#0x1
   \   000105   F0           MOVX    @DPTR,A
   \   000106   805F         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_15
   2033            }
   2034            else
   2035            {
   2036              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   000108   7401         MOV     A,#0x1
   \   00010A   12....       LCALL   ?XSTACK_DISP0_8
   \   00010D   E4           CLR     A
   \   00010E   12....       LCALL   ?Subroutine12 & 0xFFFF
   2037              EndDevicePANID=pNwkDesc->panId;
   \                     ??CrossCallReturnLabel_6:
   \   000111   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000114   90....       MOV     DPTR,#EndDevicePANID
   \   000117   E8           MOV     A,R0
   \   000118   F0           MOVX    @DPTR,A
   \   000119   A3           INC     DPTR
   \   00011A   E9           MOV     A,R1
   \   00011B   12....       LCALL   ?Subroutine12 & 0xFFFF
   2038              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \                     ??CrossCallReturnLabel_7:
   \   00011E   E0           MOVX    A,@DPTR
   \   00011F   C0E0         PUSH    A
   \   000121   7402         MOV     A,#0x2
   \   000123   12....       LCALL   ?XSTACK_DISP0_8
   \   000126   D0E0         POP     A
   \   000128   12....       LCALL   ?Subroutine12 & 0xFFFF
   2039              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \                     ??CrossCallReturnLabel_8:
   \   00012B   A3           INC     DPTR
   \   00012C   E0           MOVX    A,@DPTR
   \   00012D   C0E0         PUSH    A
   \   00012F   7403         MOV     A,#0x3
   \   000131   12....       LCALL   ?XSTACK_DISP0_8
   \   000134   D0E0         POP     A
   \   000136   12....       LCALL   ?Subroutine12 & 0xFFFF
   2040              msg.logicalChannel = pNwkDesc->logicalChannel;
   \                     ??CrossCallReturnLabel_9:
   \   000139   A3           INC     DPTR
   \   00013A   A3           INC     DPTR
   \   00013B   E0           MOVX    A,@DPTR
   \   00013C   C0E0         PUSH    A
   \   00013E   7404         MOV     A,#0x4
   \   000140   12....       LCALL   ?XSTACK_DISP0_8
   \   000143   D0E0         POP     A
   \   000145   F0           MOVX    @DPTR,A
   2041              msg.version = pNwkDesc->version;
   \   000146   85..82       MOV     DPL,?V0 + 0
   \   000149   85..83       MOV     DPH,?V0 + 1
   \   00014C   E0           MOVX    A,@DPTR
   \   00014D   C0E0         PUSH    A
   \   00014F   7405         MOV     A,#0x5
   \   000151   12....       LCALL   ?XSTACK_DISP0_8
   \   000154   D0E0         POP     A
   \   000156   F0           MOVX    @DPTR,A
   2042              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000157                ; Setup parameters for call to function sAddrExtCpy
   \   000157   AC..         MOV     R4,?V0 + 2
   \   000159   AD..         MOV     R5,?V0 + 3
   \   00015B   7406         MOV     A,#0x6
   \   00015D   12....       LCALL   ?XSTACK_DISP0_8
   \   000160   AA82         MOV     R2,DPL
   \   000162   AB83         MOV     R3,DPH
   \   000164   12....       LCALL   ??sAddrExtCpy?relay
   2043            }
   2044          
   2045            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_15:
   \   000167                ; Setup parameters for call to function ZDApp_SendMsg
   \   000167   85..82       MOV     DPL,?XSP + 0
   \   00016A   85..83       MOV     DPH,?XSP + 1
   \   00016D   AC82         MOV     R4,DPL
   \   00016F   AD83         MOV     R5,DPH
   \   000171   7B0E         MOV     R3,#0xe
   \   000173   7A01         MOV     R2,#0x1
   \   000175   12....       LCALL   ?Subroutine17 & 0xFFFF
   2046          
   2047            return (ZSuccess);
   \                     ??CrossCallReturnLabel_16:
   \   000178   7900         MOV     R1,#0x0
   \   00017A   740E         MOV     A,#0xe
   \   00017C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00017F   7F0A         MOV     R7,#0xa
   \   000181   02....       LJMP    ?BANKED_LEAVE_XDATA
   2048          }  // ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   22           RET
   2049          
   2050          /*********************************************************************
   2051           * @fn          ZDO_NetworkFormationConfirmCB
   2052           *
   2053           * @brief       This function reports the results of the request to
   2054           *              initialize a coordinator in a network.
   2055           *
   2056           * @param       Status - Result of NLME_NetworkFormationRequest()
   2057           *
   2058           * @return      none
   2059           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000003                REQUIRE ??Subroutine33_0
   \   000003                ; // Fall through to label ??Subroutine33_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2060          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2061          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2062            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2063          
   2064            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2065            {
   2066          #if defined(BLINK_LEDS)
   2067              // LED on shows Coordinator started
   2068              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine21 & 0xFFFF
   2069              // LED off forgets HOLD_AUTO_START
   2070              HalLedSet (HAL_LED_2, HAL_LED_MODE_OFF);
   2071          #endif	
   2072          #if defined ( ZBIT )
   2073              SIM_SetColor(0xd0ffd0);
   2074          #endif
   2075          
   2076              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_27:
   \   00000F   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   2077              {
   2078                // Began with HOLD_AUTO_START
   2079                devState = DEV_COORD_STARTING;
   \   000011   7408         MOV     A,#0x8
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   2080              }
   2081             
   2082            }
   2083          #if defined(BLINK_LEDS)
   2084            else
   2085            {
   2086              HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7901         MOV     R1,#0x1
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2087            }
   2088          #endif
   2089          
   2090            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A02         MOV     R2,#0x2
   \   00001F   02....       LJMP    ?Subroutine0 & 0xFFFF
   2091          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7901         MOV     R1,#0x1
   \   000004   12....       LCALL   ??HalLedSet?relay
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7902         MOV     R1,#0x2
   \   00000B   12....       LCALL   ??HalLedSet?relay
   \   00000E   90....       MOV     DPTR,#devState
   \   000011   E0           MOVX    A,@DPTR
   \   000012   22           RET
   2092          
   2093          /*********************************************************************
   2094           * @fn          ZDO_StartRouterConfirmCB
   2095           *
   2096           * @brief       This function reports the results of the request to
   2097           *              start functioning as a router in a network.
   2098           *
   2099           * @param       Status - Result of NLME_StartRouterRequest()
   2100           *
   2101           * @return      none
   2102           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2103          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2104          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2105            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2106          
   2107            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   2108            {
   2109          #if defined(BLINK_LEDS)
   2110              // LED on shows Router started
   2111          	HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine21 & 0xFFFF
   2112              // LED off forgets HOLD_AUTO_START
   2113           	HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF );
   2114          #endif
   2115          	
   2116              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_28:
   \   00000F   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   2117              {
   2118                // Began with HOLD_AUTO_START
   2119                devState = DEV_END_DEVICE;
   \   000011   7406         MOV     A,#0x6
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2120              }
   2121            }
   2122          #if defined(BLINK_LEDS)
   2123            else
   2124            {
   2125              HalLedSet( HAL_LED_1, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7901         MOV     R1,#0x1
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2126            }
   2127          #endif
   2128          
   2129            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A20         MOV     R2,#0x20
   \   00001F   02....       LJMP    ?Subroutine0 & 0xFFFF
   2130          }
   2131          
   2132          /*********************************************************************
   2133           * @fn          ZDO_JoinConfirmCB
   2134           *
   2135           * @brief       This function allows the next hight layer to be notified
   2136           *              of the results of its request to join itself or another
   2137           *              device to a network.
   2138           *
   2139           * @param       Status - Result of NLME_JoinRequest()
   2140           *
   2141           * @return      none
   2142           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2143          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2144          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2145            (void)PanId;  // remove if this parameter is used.
   2146          
   2147            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2148          
   2149            if ( Status == ZSUCCESS )
   \   00000A   700D         JNZ     ??ZDO_JoinConfirmCB_0
   2150            {
   2151          #if defined(BLINK_LEDS)
   2152              // LED on shows device joined
   2153          	HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine21 & 0xFFFF
   2154              // LED off forgets HOLD_AUTO_START
   2155          	HalLedSet ( HAL_LED_2, HAL_LED_MODE_OFF );
   2156          #endif
   2157          	
   2158              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_29:
   \   00000F   7003         JNZ     ??ZDO_JoinConfirmCB_1
   2159              {
   2160                // Began with HOLD_AUTO_START
   2161                devState = DEV_NWK_JOINING;
   \   000011   7403         MOV     A,#0x3
   \   000013   F0           MOVX    @DPTR,A
   2162              }
   2163          
   2164              if ( !ZG_SECURE_ENABLED )
   2165              {
   2166                // Notify to save info into NV
   2167                ZDApp_NVUpdate();
   2168              }
   2169            /*****************************************************
   2170            ******************************************************
   2171            ******************************************************
   2172            ******************************************************/
   2173          #if (ZDO_COORDINATOR)
   2174          #else
   2175          #if !defined( NV_RESTORE )
   2176          ZigBee_C_R_E_Engineering_C();
   \                     ??ZDO_JoinConfirmCB_1:
   \   000014                ; Setup parameters for call to function ZigBee_C_R_E_Engineering_C
   \   000014   12....       LCALL   ??ZigBee_C_R_E_Engineering_C?relay
   \   000017   8007         SJMP    ??ZDO_JoinConfirmCB_2
   2177          #endif
   2178          #endif
   2179            /*****************************************************
   2180            ******************************************************
   2181            ******************************************************
   2182            ******************************************************/
   2183            }
   2184            else
   2185            {
   2186          #if defined(BLINK_LEDS)
   2187             HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000019                ; Setup parameters for call to function HalLedSet
   \   000019   7A04         MOV     R2,#0x4
   \   00001B   7901         MOV     R1,#0x1
   \   00001D   12....       LCALL   ??HalLedSet?relay
   2188          #endif
   2189            }
   2190          
   2191            // Notify ZDApp
   2192            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_2:
   \   000020                ; Setup parameters for call to function ZDApp_SendMsg
   \   000020   7C00         MOV     R4,#0x0
   \   000022   7D00         MOV     R5,#0x0
   \   000024   7B02         MOV     R3,#0x2
   \   000026   7A02         MOV     R2,#0x2
   \   000028   02....       LJMP    ?Subroutine5 & 0xFFFF
   2193          }
   2194          
   2195          /*********************************************************************
   2196           * @fn          ZDO_AddrChangeIndicationCB
   2197           *
   2198           * @brief       This function notifies the application that this
   2199           *              device's address has changed.  Could happen in
   2200           *              a network with stochastic addressing (PRO).
   2201           *
   2202           * @param       newAddr - the new address
   2203           *
   2204           * @return      none
   2205           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2206          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2207          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2208            (void)newAddr;  // remove if this parameter is used
   2209          
   2210            // Notify to save info into NV
   2211            ZDApp_NVUpdate();
   2212          
   2213            // Notify the applications
   2214            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine13 & 0xFFFF
   2215          
   2216            // Send out a device announce
   2217            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_43:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2218          }
   \   00000A   02....       LJMP    ?Subroutine2 & 0xFFFF
   2219          
   2220          /*********************************************************************
   2221           * @fn          ZDO_JoinIndicationCB
   2222           *
   2223           * @brief       This function allows the next higher layer of a
   2224           *              coordinator to be notified of a remote join request.
   2225           *
   2226           * @param       ShortAddress - 16-bit address
   2227           * @param       ExtendedAddress - IEEE (64-bit) address
   2228           * @param       CapabilityFlags - Association Capability Flags
   2229           * @param       type - of joining -
   2230           *                          NWK_ASSOC_JOIN
   2231           *                          NWK_ASSOC_REJOIN_UNSECURE
   2232           *                          NWK_ASSOC_REJOIN_SECURE
   2233           *
   2234           * @return      ZStatus_t
   2235           */
   2236          ZStatus_t ZDO_JoinIndicationCB(uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2237                                          uint8 CapabilityFlags, uint8 type)
   2238          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2239            (void)ShortAddress;
   2240            (void)ExtendedAddress;
   2241          #if ZDO_NV_SAVE_RFDs
   2242            (void)CapabilityFlags;
   2243          
   2244          #else  // if !ZDO_NV_SAVE_RFDs
   2245            if (CapabilityFlags & CAPINFO_DEVICETYPE_FFD)
   2246          #endif
   2247            {
   2248              ZDApp_NVUpdate();  // Notify to save info into NV.
   2249            }
   2250          
   2251            if (ZG_SECURE_ENABLED)  // Send notification to TC of new device.
   2252            {
   2253              if (type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE)
   2254              {
   2255                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2256              }
   2257            }
   2258          
   2259            return ZSuccess;
   \   000000                REQUIRE ?Subroutine3
   \   000000                ; // Fall through to label ?Subroutine3

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2260          }
   2261          
   2262          /*********************************************************************
   2263           * @fn          ZDO_ConcentratorIndicationCB
   2264           *
   2265           * @brief       This function allows the next higher layer of a
   2266           *              device to be notified of existence of the concentrator.
   2267           *
   2268           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2269           * @param       extAddr - pointer to extended Address
   2270           *                        NULL if not available
   2271           * @param       pktCost - PktCost from RREQ
   2272           *
   2273           * @return      void
   2274           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2275          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr, uint8 *extAddr, uint8 pktCost )
   \                     ZDO_ConcentratorIndicationCB:
   2276          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   2277            zdoConcentratorInd_t conInd;
   2278          
   2279            conInd.nwkAddr = nwkAddr;
   \   00000A   12....       LCALL   ?Subroutine10 & 0xFFFF
   2280            conInd.extAddr = extAddr;
   \                     ??CrossCallReturnLabel_70:
   \   00000D   7402         MOV     A,#0x2
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   EC           MOV     A,R4
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   ED           MOV     A,R5
   \   000016   F0           MOVX    @DPTR,A
   2281            conInd.pktCost = pktCost;
   \   000017   7404         MOV     A,#0x4
   \   000019   12....       LCALL   ?XSTACK_DISP0_8
   \   00001C   E9           MOV     A,R1
   \   00001D   F0           MOVX    @DPTR,A
   2282          
   2283            if( zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID] != NULL )
   \   00001E   90....       MOV     DPTR,#(zdoCBFunc + 2)
   \   000021   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000024   E8           MOV     A,R0
   \   000025   7001         JNZ     ??ZDO_ConcentratorIndicationCB_0
   \   000027   E9           MOV     A,R1
   \                     ??ZDO_ConcentratorIndicationCB_0:
   \   000028   6011         JZ      ??ZDO_ConcentratorIndicationCB_1
   2284          {
   2285              zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID]( (void*)&conInd );
   \   00002A                ; Setup parameters for indirect call
   \   00002A   85..82       MOV     DPL,?XSP + 0
   \   00002D   85..83       MOV     DPH,?XSP + 1
   \   000030   AA82         MOV     R2,DPL
   \   000032   AB83         MOV     R3,DPH
   \   000034   8882         MOV     DPL,R0
   \   000036   8983         MOV     DPH,R1
   \   000038   12....       LCALL   ?CALL_IND
   2286            }
   2287          }
   \                     ??ZDO_ConcentratorIndicationCB_1:
   \   00003B                REQUIRE ?Subroutine6
   \   00003B                ; // Fall through to label ?Subroutine6

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7405         MOV     A,#0x5
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   02....       LJMP    ??Subroutine33_0 & 0xFFFF
   2288          
   2289          /*********************************************************************
   2290           * @fn          ZDO_LeaveCnf
   2291           *
   2292           * @brief       This function allows the next higher layer to be
   2293           *              notified of the results of its request for this or
   2294           *              a child device to leave the network.
   2295           *
   2296           * @param       cnf - NLME_LeaveCnf_t
   2297           *
   2298           * @return      none
   2299           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2300          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2301          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2302            // Check for this device
   2303            if ( osal_ExtAddrEqual( cnf->extAddr,
   2304                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   7009         JNZ     ??ZDO_LeaveCnf_0
   2305            {
   2306              // Prepare to leave with reset
   2307              ZDApp_LeaveReset( cnf->rejoin );
   \   000026                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000026   12....       LCALL   ?Subroutine25 & 0xFFFF
   2308            }
   \                     ??CrossCallReturnLabel_63:
   \   000029   F9           MOV     R1,A
   \   00002A   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00002D   8017         SJMP    ??ZDO_LeaveCnf_1
   2309            else if ( ZSTACK_ROUTER_BUILD )
   2310            {
   2311              // Remove device address(optionally descendents) from data
   2312              ZDApp_LeaveUpdate( cnf->dstAddr,
   2313                                 cnf->extAddr,
   2314                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   00002F                ; Setup parameters for call to function NLME_RemoveChild
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   A3           INC     DPTR
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   F9           MOV     R1,A
   \   00003F   AA..         MOV     R2,?V0 + 0
   \   000041   AB..         MOV     R3,?V0 + 1
   \   000043   12....       LCALL   ??NLME_RemoveChild?relay
   2315            }
   2316          }
   \                     ??ZDO_LeaveCnf_1:
   \   000046   02....       LJMP    ??Subroutine36_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine25:
   \   000000   EE           MOV     A,R6
   \   000001   240B         ADD     A,#0xb
   \   000003                REQUIRE ??Subroutine34_0
   \   000003                ; // Fall through to label ??Subroutine34_0
   2317          
   2318          /*********************************************************************
   2319           * @fn          ZDO_LeaveInd
   2320           *
   2321           * @brief       This function allows the next higher layer of a
   2322           *              device to be notified of a remote leave request or
   2323           *              indication.
   2324           *
   2325           * @param       ind - NLME_LeaveInd_t
   2326           *
   2327           * @return      none
   2328           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2329          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2330          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2331            uint8 leave;
   2332          
   2333          
   2334            // Parent is requesting the leave - NWK layer filters out illegal
   2335            // requests
   2336            if ( ind->request == TRUE )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   000014   240B         ADD     A,#0xb
   \   000016   18           DEC     R0
   \   000017   EF           MOV     A,R7
   \   000018   3400         ADDC    A,#0x0
   \   00001A   F9           MOV     R1,A
   \   00001B   88..         MOV     ?V0 + 2,R0
   \   00001D   89..         MOV     ?V0 + 3,R1
   \   00001F   8E82         MOV     DPL,R6
   \   000021   8F83         MOV     DPH,R7
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6401         XRL     A,#0x1
   \   000030   7031         JNZ     ??ZDO_LeaveInd_0
   2337            {
   2338              // Notify network of leave
   2339              if ( ZSTACK_ROUTER_BUILD )
   2340              {
   2341                NLME_LeaveRsp_t rsp;
   2342                rsp.rejoin         = ind->rejoin;
   \   000032   85..82       MOV     DPL,?V0 + 0
   \   000035   85..83       MOV     DPH,?V0 + 1
   \   000038   E0           MOVX    A,@DPTR
   \   000039   C0E0         PUSH    A
   \   00003B   7401         MOV     A,#0x1
   \   00003D   12....       LCALL   ?XSTACK_DISP0_8
   \   000040   D0E0         POP     A
   \   000042   F0           MOVX    @DPTR,A
   2343                rsp.removeChildren = ind->removeChildren;
   \   000043   8882         MOV     DPL,R0
   \   000045   8983         MOV     DPH,R1
   \   000047   E0           MOVX    A,@DPTR
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   F0           MOVX    @DPTR,A
   2344                NLME_LeaveRsp( &rsp );
   \   00004F                ; Setup parameters for call to function NLME_LeaveRsp
   \   00004F   AA82         MOV     R2,DPL
   \   000051   AB83         MOV     R3,DPH
   \   000053   12....       LCALL   ??NLME_LeaveRsp?relay
   2345              }
   2346          
   2347              // Prepare to leave with reset
   2348              ZDApp_LeaveReset( ind->rejoin );
   \   000056                ; Setup parameters for call to function ZDApp_LeaveReset
   \                     ??ZDO_LeaveInd_1:
   \   000056   85..82       MOV     DPL,?V0 + 0
   \   000059   85..83       MOV     DPH,?V0 + 1
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000061   802D         SJMP    ??ZDO_LeaveInd_2
   2349            }
   2350            else
   2351            {
   2352              leave = FALSE;
   2353          
   2354              // Check if this device needs to leave as a child or descendent
   2355              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000063                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000063   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000066   85..82       MOV     DPL,?V0 + 2
   \   000069   85..83       MOV     DPH,?V0 + 3
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F9           MOV     R1,A
   \   00006E   8E82         MOV     DPL,R6
   \   000070   8F83         MOV     DPH,R7
   \   000072   E0           MOVX    A,@DPTR
   \   000073   6A           XRL     A,R2
   \   000074   7003         JNZ     ??ZDO_LeaveInd_3
   \   000076   A3           INC     DPTR
   \   000077   E0           MOVX    A,@DPTR
   \   000078   6B           XRL     A,R3
   \                     ??ZDO_LeaveInd_3:
   \   000079   700A         JNZ     ??ZDO_LeaveInd_4
   2356              {
   2357                if ( ( ind->removeChildren == TRUE               ) ||
   2358                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2359                       NODETYPE_DEVICE                           )    )
   \   00007B   7401         MOV     A,#0x1
   \   00007D   69           XRL     A,R1
   \   00007E   60D6         JZ      ??ZDO_LeaveInd_1
   \   000080   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000083   60D1         JZ      ??ZDO_LeaveInd_1
   2360                {
   2361                  leave = TRUE;
   2362                }
   2363              }
   2364              else if ( ind->removeChildren == TRUE )
   2365              {
   2366                // Check NWK address allocation algorithm
   2367                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2368              }
   2369          
   2370              if ( leave == TRUE )
   2371              {
   2372                // Prepare to leave with reset
   2373                ZDApp_LeaveReset( ind->rejoin );
   \   000085                ; Setup parameters for call to function ZDApp_LeaveReset
   2374              }
   2375              else
   2376              {
   2377                // Remove device address(optionally descendents) from data
   2378                ZDApp_LeaveUpdate( ind->srcAddr,
   2379                                   ind->extAddr,
   2380                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   000085                ; Setup parameters for call to function NLME_RemoveChild
   \   000085   EE           MOV     A,R6
   \   000086   2402         ADD     A,#0x2
   \   000088   FA           MOV     R2,A
   \   000089   EF           MOV     A,R7
   \   00008A   3400         ADDC    A,#0x0
   \   00008C   FB           MOV     R3,A
   \   00008D   12....       LCALL   ??NLME_RemoveChild?relay
   2381              }
   2382            }
   2383          }
   \                     ??ZDO_LeaveInd_2:
   \   000090   7402         MOV     A,#0x2
   \   000092   12....       LCALL   ?DEALLOC_XSTACK8
   \   000095   7F06         MOV     R7,#0x6
   \   000097   02....       LJMP    ?BANKED_LEAVE_XDATA
   2384          
   2385          /*********************************************************************
   2386           * @fn          ZDO_SyncIndicationCB
   2387           *
   2388           * @brief       This function allows the next higher layer of a
   2389           *              coordinator to be notified of a loss of synchronization
   2390           *                          with the parent/child device.
   2391           *
   2392           * @param       type: 0 - child; 1 - parent
   2393           *
   2394           *
   2395           * @return      none
   2396           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2397          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2398          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2399            (void)shortAddr;  // Remove this line if this parameter is used.
   2400          
   2401            if ( ZSTACK_END_DEVICE_BUILD
   2402              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityFlags & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000007   90....       MOV     DPTR,#(_NIB + 14)
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   4013         JC      ??CrossCallReturnLabel_17
   2403            {
   2404              if ( type == 1 )
   \   00000F   7401         MOV     A,#0x1
   \   000011   6E           XRL     A,R6
   \   000012   700E         JNZ     ??CrossCallReturnLabel_17
   2405              {
   2406                // We lost contact with our parent.  Clear the neighbor Table.
   2407                nwkNeighborInitTable();
   \   000014                ; Setup parameters for call to function nwkNeighborInitTable
   \   000014   12....       LCALL   ??nwkNeighborInitTable?relay
   2408          
   2409                // Start the rejoin process.
   2410                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000017                ; Setup parameters for call to function ZDApp_SendMsg
   \   000017   7C00         MOV     R4,#0x0
   \   000019   7D00         MOV     R5,#0x0
   \   00001B   7B02         MOV     R3,#0x2
   \   00001D   7A03         MOV     R2,#0x3
   \   00001F   12....       LCALL   ?Subroutine17 & 0xFFFF
   2411              }
   2412            }
   2413          }
   \                     ??CrossCallReturnLabel_17:
   \   000022   02....       LJMP    ??Subroutine33_0 & 0xFFFF
   2414          
   2415          /*********************************************************************
   2416           * @fn          ZDO_ManytoOneFailureIndicationCB
   2417           *
   2418           * @brief       This function allows the next higher layer of a
   2419           *              concentrator to be notified of a many-to-one route
   2420           *              failure.
   2421           *
   2422           * @param       none
   2423           *
   2424           *
   2425           * @return      none
   2426           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2427          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2428          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2429            // By default, the concentrator automatically redo many-to-one route
   2430            // discovery to update all many-to-one routes in the network
   2431            // If you want anything processing other than the default,
   2432            // please replace the following code.
   2433          
   2434            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2435          }
   \   000007   02....       LJMP    ?Subroutine2 & 0xFFFF
   2436          
   2437          /*********************************************************************
   2438           * @fn          ZDO_PollConfirmCB
   2439           *
   2440           * @brief       This function allows the next higher layer to be
   2441           *              notified of a Poll Confirm.
   2442           *
   2443           * @param       none
   2444           *
   2445           * @return      none
   2446           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2447          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2448          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2449            (void)status;  // Remove this line if this parameter is used.
   2450            return;
   \   000000   02....       LJMP    ?BRET
   2451          }
   2452          
   2453          /******************************************************************************
   2454           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2455           *
   2456           * @brief       Stub routine implemented by NHLE. NHLE should call
   2457           *              <AddrMgrWriteNV> when appropriate.
   2458           *
   2459           * @param       none
   2460           *
   2461           * @return      none
   2462           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2463          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2464          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2465          #if defined ( NV_RESTORE )
   2466            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2467            {
   2468              // Trigger to save info into NV
   2469              ZDApp_NVUpdate();
   2470            }
   2471          #endif
   2472          }
   \   000000   02....       LJMP    ?BRET
   2473          
   2474          /*********************************************************************
   2475           * Call Back Functions from Security  - API
   2476           */
   2477          
   2478           /*********************************************************************
   2479           * @fn          ZDO_UpdateDeviceIndication
   2480           *
   2481           * @brief       This function notifies the "Trust Center" of a
   2482           *              network when a device joins or leaves the network.
   2483           *
   2484           * @param       extAddr - pointer to 64 bit address of new device
   2485           * @param       status  - 0 if a new device joined securely
   2486           *                      - 1 if a new device joined un-securely
   2487           *                      - 2 if a device left the network
   2488           *
   2489           * @return      true if newly joined device should be allowed to
   2490           *                                              remain on network
   2491           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2492          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2493          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2494            // can implement a network access policy based on the
   2495            // IEEE address of newly joining devices...
   2496            (void)extAddr;
   2497            (void)status;
   2498          
   2499            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine3 & 0xFFFF
   2500          }
   2501          
   2502          /*********************************************************************
   2503           * @fn          ZDApp_InMsgCB
   2504           *
   2505           * @brief       This function is called to pass up any message that is
   2506           *              not yet supported.  This allows for the developer to
   2507           *              support features themselves..
   2508           *
   2509           * @return      none
   2510           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2511          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2512          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2513            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000016   7480         MOV     A,#-0x80
   \   000018   59           ANL     A,R1
   \   000019   FB           MOV     R3,A
   \   00001A   E4           CLR     A
   \   00001B   7001         JNZ     ??ZDApp_InMsgCB_0
   \   00001D   EB           MOV     A,R3
   \                     ??ZDApp_InMsgCB_0:
   \   00001E   7046         JNZ     ??ZDApp_InMsgCB_1
   2514            {
   2515              // Handle the response message
   2516            }
   2517            else
   2518            {
   2519              // Handle the request message by sending a generic "not supported".
   2520              // Device Announce doesn't have a response.
   2521              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000020   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_64:
   \   000023   7041         JNZ     ??ZDApp_InMsgCB_1
   \   000025   7413         MOV     A,#0x13
   \   000027   68           XRL     A,R0
   \   000028   7001         JNZ     ??ZDApp_InMsgCB_2
   \   00002A   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_2:
   \   00002B   6039         JZ      ??ZDApp_InMsgCB_1
   2522              {
   2523                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2524                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   00002D                ; Setup parameters for call to function ZDP_GenericRsp
   \   00002D   E8           MOV     A,R0
   \   00002E   F5..         MOV     ?V0 + 0,A
   \   000030   7480         MOV     A,#-0x80
   \   000032   49           ORL     A,R1
   \   000033   F5..         MOV     ?V0 + 1,A
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..00       MOV     ?V0 + 0,#0x0
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   EE           MOV     A,R6
   \   000046   240E         ADD     A,#0xe
   \   000048   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   2525              }
   2526            }
   \                     ??CrossCallReturnLabel_61:
   \   00004B   FD           MOV     R5,A
   \   00004C   7C84         MOV     R4,#-0x7c
   \   00004E   EE           MOV     A,R6
   \   00004F   2402         ADD     A,#0x2
   \   000051   0A           INC     R2
   \   000052   0A           INC     R2
   \   000053   EF           MOV     A,R7
   \   000054   3400         ADDC    A,#0x0
   \   000056   FB           MOV     R3,A
   \   000057   EE           MOV     A,R6
   \   000058   240F         ADD     A,#0xf
   \   00005A   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_62:
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDP_GenericRsp?relay
   \   000061   7404         MOV     A,#0x4
   \   000063   12....       LCALL   ?DEALLOC_XSTACK8
   2527          }
   \                     ??ZDApp_InMsgCB_1:
   \   000066   02....       LJMP    ??Subroutine36_0 & 0xFFFF
   2528          
   2529          
   2530          /*********************************************************************
   2531           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2532           *
   2533           * @brief   Changes the Match Descriptor Response permission.
   2534           *
   2535           * @param   endpoint - endpoint to allow responses
   2536           * @param   action - true to allow responses, false to not
   2537           *
   2538           * @return  none
   2539           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2540          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2541          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   2542            // Store the action
   2543            afSetMatch( endpoint, action );
   \   000005                ; Setup parameters for call to function afSetMatch
   \   000005   12....       LCALL   ??afSetMatch?relay
   2544          }
   \   000008   02....       LJMP    ??Subroutine33_0 & 0xFFFF
   2545          
   2546          /*********************************************************************
   2547           * @fn      ZDApp_NetworkInit()
   2548           *
   2549           * @brief   Used to start the network joining process
   2550           *
   2551           * @param   delay - mSec delay to wait before starting
   2552           *
   2553           * @return  none
   2554           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2555          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2556          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2557            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   600B         JZ      ??ZDApp_NetworkInit_1
   2558            {
   2559              // Wait awhile before starting the device
   2560              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   12....       LCALL   ?Subroutine15 & 0xFFFF
   2561            }
   \                     ??CrossCallReturnLabel_57:
   \   000013   8005         SJMP    ??CrossCallReturnLabel_46
   2562            else
   2563            {
   2564              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A01         MOV     R2,#0x1
   \   000017   12....       LCALL   ??Subroutine29_0 & 0xFFFF
   2565            }
   2566          }
   \                     ??CrossCallReturnLabel_46:
   \   00001A   02....       LJMP    ?Subroutine2 & 0xFFFF
   2567          
   2568          /*********************************************************************
   2569           * @fn      ZDApp_NwkStateUpdateCB()
   2570           *
   2571           * @brief   This function notifies that this device's network
   2572           *          state info has been changed.
   2573           *
   2574           * @param   none
   2575           *
   2576           * @return  none
   2577           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2578          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2579          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2580            // Notify to save info into NV
   2581            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2582            {
   2583              // Trigger to save info into NV
   2584              ZDApp_NVUpdate();
   2585            }
   2586          }
   \   000010   02....       LJMP    ?Subroutine2 & 0xFFFF
   2587          
   2588          /*********************************************************************
   2589           * @fn      ZDApp_NodeProfileSync()
   2590           *
   2591           * @brief   Sync node with stack profile.
   2592           *
   2593           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2594           *
   2595           * @return  none
   2596           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2597          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2598          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2599            networkDesc_t* desc;
   2600            uint16         panID;
   2601          
   2602            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5058         JNC     ??ZDApp_NodeProfileSync_0
   2603            {
   2604              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2605          
   2606              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2607          
   2608              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6024         JZ      ??ZDApp_NodeProfileSync_0
   2609              {
   2610                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   6013         JZ      ??ZDApp_NodeProfileSync_0
   2611                {
   2612                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2613                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2614                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000061                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2615                }
   2616              }
   2617            }
   2618          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000065   80..         SJMP    ??Subroutine36_0
   2619          
   2620          /*********************************************************************
   2621           * @fn      ZDApp_StartJoiningCycle()
   2622           *
   2623           * @brief   Starts the joining cycle of a device.  This will only
   2624           *          continue an already started (or stopped) joining cycle.
   2625           *
   2626           * @param   none
   2627           *
   2628           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2629           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2630          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2631          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2632            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2633            {
   2634              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   F0           MOVX    @DPTR,A
   2635              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2636          
   2637              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2638            }
   2639            else
   2640              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ?Subroutine2 & 0xFFFF
   2641          }
   2642          
   2643          /*********************************************************************
   2644           * @fn      ZDApp_StopJoiningCycle()
   2645           *
   2646           * @brief   Stops the joining or rejoining process of a device.
   2647           *
   2648           * @param   none
   2649           *
   2650           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2651           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2652          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2653          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2654            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2655            {
   2656              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2657              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2658            }
   2659            else
   2660              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ?Subroutine2 & 0xFFFF
   2661          }
   2662          
   2663          /*********************************************************************
   2664           * @fn      ZDApp_AnnounceNewAddress()
   2665           *
   2666           * @brief   Send Device Announce and hold all transmissions for
   2667           *          new address timeout.
   2668           *
   2669           * @param   none
   2670           *
   2671           * @return  none
   2672           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2673          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2674          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2675          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2676            // Turn off data request hold
   2677            APSME_HoldDataRequests( 0 );
   2678          #endif
   2679          
   2680            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2681                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   80..         SJMP    ??Subroutine35_0
   2682          
   2683          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2684            // Setup the timeout
   2685            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2686          #endif
   2687          }
   2688          
   2689          /*********************************************************************
   2690           * @fn          ZDApp_NVUpdate
   2691           *
   2692           * @brief       Set the NV Update Timer.
   2693           *
   2694           * @param       none
   2695           *
   2696           * @return      none
   2697           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2698          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2699          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2700          #if defined ( NV_RESTORE )
   2701            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2702          #endif
   2703          }
   \   000000   02....       LJMP    ?BRET
   2704          
   2705          /*********************************************************************
   2706           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2707           *
   2708           * @brief   Returns a PAN ID for the network layer to use during
   2709           *          a coordinator start and there is another network with
   2710           *          the intended PANID.
   2711           *
   2712           * @param   panid - the intended PAN ID
   2713           *
   2714           * @return  PANID to try
   2715           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2716          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2717          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2718            return ( panid + 1 );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   0A           INC     R2
   \   000004   E4           CLR     A
   \   000005   3B           ADDC    A,R3
   \   000006   FB           MOV     R3,A
   \   000007   02....       LJMP    ?BRET
   2719          }
   2720          
   2721          /*********************************************************************
   2722           * @fn          ZDO_SrcRtgIndCB
   2723           *
   2724           * @brief       This function notifies the ZDO available src route record received.
   2725           *
   2726           * @param       srcAddr - source address of the source route
   2727           * @param       relayCnt - number of devices in the relay list
   2728           * @param       relayList - relay list of the source route
   2729           *
   2730           * @return      none
   2731           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2732          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2733          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   2734            zdoSrcRtg_t srcRtg;
   2735          
   2736            srcRtg.srcAddr = srcAddr;
   \   00000A   12....       LCALL   ?Subroutine10 & 0xFFFF
   2737            srcRtg.relayCnt = relayCnt;
   \                     ??CrossCallReturnLabel_71:
   \   00000D   7402         MOV     A,#0x2
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   E9           MOV     A,R1
   \   000013   F0           MOVX    @DPTR,A
   2738            srcRtg.pRelayList = pRelayList;
   \   000014   7403         MOV     A,#0x3
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   EC           MOV     A,R4
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   ED           MOV     A,R5
   \   00001D   F0           MOVX    @DPTR,A
   2739          
   2740            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   00001E   90....       MOV     DPTR,#zdoCBFunc
   \   000021   E0           MOVX    A,@DPTR
   \   000022   7002         JNZ     ??ZDO_SrcRtgIndCB_0
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000026   6013         JZ      ??ZDO_SrcRtgIndCB_1
   2741            {
   2742              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000028                ; Setup parameters for indirect call
   \   000028   85..82       MOV     DPL,?XSP + 0
   \   00002B   85..83       MOV     DPH,?XSP + 1
   \   00002E   AA82         MOV     R2,DPL
   \   000030   AB83         MOV     R3,DPH
   \   000032   90....       MOV     DPTR,#zdoCBFunc
   \   000035   12....       LCALL   ?Subroutine20 & 0xFFFF
   2743            }
   \                     ??CrossCallReturnLabel_26:
   \   000038   12....       LCALL   ?CALL_IND
   2744          }
   \                     ??ZDO_SrcRtgIndCB_1:
   \   00003B   02....       LJMP    ?Subroutine6 & 0xFFFF
   2745          
   2746          
   2747          /*********************************************************************
   2748           * @fn          ZDO_RegisterForZdoCB
   2749           *
   2750           * @brief       Call this function to register the higher layer (for
   2751           *              example, the Application layer or MT layer) with ZDO
   2752           *              callbacks to get notified of some ZDO indication like
   2753           *              existence of a concentrator or receipt of a source
   2754           *              route record.
   2755           *
   2756           * @param       indID - ZDO Indication ID
   2757           * @param       pFn   - Callback function pointer
   2758           *
   2759           * @return      ZSuccess - successful, ZInvalidParameter if not
   2760           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2761          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   2762          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FC           MOV     R4,A
   2763            // Check the range of the indication ID
   2764            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   C3           CLR     C
   \   000007   9402         SUBB    A,#0x2
   \   000009   5018         JNC     ??ZDO_RegisterForZdoCB_0
   2765            {
   2766              zdoCBFunc[indID] = pFn;
   \   00000B   EC           MOV     A,R4
   \   00000C   C3           CLR     C
   \   00000D   33           RLC     A
   \   00000E   F8           MOV     R0,A
   \   00000F   E4           CLR     A
   \   000010   33           RLC     A
   \   000011   F9           MOV     R1,A
   \   000012   E8           MOV     A,R0
   \   000013   24..         ADD     A,#(zdoCBFunc & 0xff)
   \   000015   F582         MOV     DPL,A
   \   000017   E9           MOV     A,R1
   \   000018   34..         ADDC    A,#((zdoCBFunc >> 8) & 0xff)
   \   00001A   F583         MOV     DPH,A
   \   00001C   12....       LCALL   ??Subroutine37_0 & 0xFFFF
   2767              return ZSuccess;
   \                     ??CrossCallReturnLabel_68:
   \   00001F   7900         MOV     R1,#0x0
   \   000021   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   2768            }
   2769          
   2770            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000023   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000025   02....       LJMP    ?Subroutine2 & 0xFFFF
   2771          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB
   2772          
   2773          /*********************************************************************
   2774          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      9
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> ZDAppCheckForHoldKey          0      0     18
       -> ZDO_Init                      0      0     18
       -> afRegister                    0      0     18
       -> ZDApp_InitUserDesc            0      0     18
       -> ZDOInitDevice                 0      0     18
       -> HalLedBlink                   0      0     18
       -> ZDApp_RegisterCBs             0      0     18
     ZDApp_InitUserDesc                 0      0     40
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   0      0     25
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> ZDApp_ResetTimerStart         0      0     18
     ZDApp_LeaveUpdate                  0      0      9
       -> NLME_RemoveChild              0      0     18
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     16
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     10
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     26
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     47
       -> ZDO_ParseAddrRsp              0      0     62
       -> ZDO_UpdateAddrManager         0      0     62
       -> osal_mem_free                 0      0     62
       -> ZDO_ParseBindUnbindReq        0      0     62
       -> ZDO_ProcessBindUnbindReq      0      0     62
     ZDApp_ProcessNetworkJoin           0      0     28
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               1      0     27
       -> ZDP_IncomingData              0      0     32
       -> ZDApp_ProcessMsgCBs           0      0     32
       -> ZDApp_NodeProfileSync         0      0     32
       -> NLME_JoinRequest              0      0     34
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> osal_rand                     0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> ZMacSetReq                    0      0     32
       -> NLME_ReJoinRequest            0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> NLME_SetPollRate              0      0     32
       -> NLME_SetQueuedPollRate        0      0     32
       -> NLME_SetResponseRate          0      0     32
       -> osal_rand                     0      0     32
       -> ZDApp_NetworkInit             0      0     32
       -> ZDApp_ProcessNetworkJoin      0      0     32
       -> sAddrExtCpy                   0      0     32
       -> ZDApp_NetworkInit             0      0     32
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
       -> ZDSecMgrSaveTCLinkKey         0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrTransportKeyInd       4      0      0
       -> ZDSecMgrRemoveDeviceInd       4      0      0
       -> ZDSecMgrSwitchKeyInd          4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      9
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      9
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                2      0     37
       -> osal_nv_read                  0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SecInit                      0      0     21
       -> ZDSecMgrInit                  0      0     18
       -> ZigBee_C_R_E_Engineering_A
                                        0      0     18
     ZDApp_SendEventMsg                 0      0      9
       -> ZDApp_SendMsg                 0      0     18
     ZDApp_SendMsg                      1      0     54
       -> osal_msg_allocate             0      0     38
       -> osal_memcpy                   0      0     44
       -> osal_msg_send                 0      0     38
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> HalLedSet                     0      0     20
       -> ZDO_StartDevice               0      0     20
       -> HalLedSet                     0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDApp_NetworkStartEvt         0      0     20
       -> osal_pwrmgr_device            0      0     20
       -> osal_set_event                0      0     20
       -> HalLedSet                     0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> ZigBee_C_R_E_Engineering_B
                                        0      0     20
       -> osal_start_timerEx            0      0     20
       -> Onboard_soft_reset            0      0     20
     ZDOInitDevice                      0      0     21
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> zgWriteStartupOptions         0      0     24
       -> osal_set_event                0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_SecInit                 0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       1      0     14
     ZDO_JoinConfirmCB                  0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> ZigBee_C_R_E_Engineering_C
                                        0      0     18
       -> HalLedSet                     0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_RemoveChild              0      0     20
     ZDO_LeaveInd                       1      0     16
       -> NLME_LeaveRsp                 0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_GetCoordShortAddr        0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_RemoveChild              0      0     32
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     14
     ZDO_StartRouterConfirmCB           0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                      4
     ZDAppNumber                                    1
     ZDAppTaskID                                    1
     EndDevicePANID                                 2
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    79
     ??Subroutine33_0                               5
     ZDApp_SecInit                                 14
     ZDApp_event_loop                             256
     ?Subroutine13                                  2
     ??Subroutine29_0                              11
     ??Subroutine32_0                               6
     ??Subroutine36_0                               5
     ZDApp_ProcessSecEvent                        141
     ?Subroutine15                                  5
     ?Subroutine19                                  6
     ??Subroutine37_0                               6
     ZDOInitDevice                                142
     ?Subroutine1                                   2
     ??Subroutine35_0                               3
     ?Subroutine10                                  6
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ?Subroutine2                                   7
     ZDApp_NetworkStartEvt                         81
     ZDApp_DeviceAuthEvt                           60
     ?Subroutine14                                  9
     ?Subroutine8                                  19
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     67
     ?Subroutine9                                  13
     ZDApp_InitUserDesc                            93
     ?Subroutine24                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                         464
     ?Subroutine23                                 22
     ?Subroutine22                                 14
     ?Subroutine28                                 13
     ?Subroutine26                                 11
     ?Subroutine20                                  9
     ZDApp_ProcessMsgCBs                          129
     ?Subroutine7                                   5
     ??Subroutine34_0                               9
     ZDApp_RegisterCBs                             31
     ?Subroutine16                                  2
     ??Subroutine30_0                               9
     ZDApp_ProcessSecMsg                           84
     ZDApp_ProcessNetworkJoin                     368
     ?Subroutine18                                 12
     ZDApp_SaveNwkKey                              99
     ?Subroutine4                                  10
     ?Subroutine27                                  6
     ??Subroutine31_0                               8
     ZDApp_ResetNwkKey                             38
     ZDApp_RestoreNwkKey                          157
     ZDApp_ResetTimerStart                         16
     ZDApp_ResetTimerCancel                        19
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine11                                 14
     ZDApp_LeaveCtrlSet                            53
     ZDApp_LeaveCtrlBypass                         14
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              17
     ZDApp_LeaveUpdate                             14
     ZDApp_SendEventMsg                            11
     ?Subroutine5                                   5
     ?Subroutine17                                  9
     ZDApp_SendMsg                                100
     ZDO_NetworkDiscoveryConfirmCB                388
     ?Subroutine12                                  6
     ?Subroutine0                                   3
     ZDO_NetworkFormationConfirmCB                 34
     ?Subroutine21                                 19
     ZDO_StartRouterConfirmCB                      34
     ZDO_JoinConfirmCB                             43
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine3                                   5
     ZDO_ConcentratorIndicationCB                  59
     ?Subroutine6                                   8
     ZDO_LeaveCnf                                  73
     ?Subroutine25                                  3
     ZDO_LeaveInd                                 154
     ZDO_SyncIndicationCB                          37
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                105
     ZDApp_ChangeMatchDescRespPermission
                                                   11
     ZDApp_NetworkInit                             29
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        103
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      41
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   10
     ZDO_SrcRtgIndCB                               62
     ZDO_RegisterForZdoCB                          40
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_0                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDO_RegisterForZdoCB?relay                   6

 
 4 491 bytes in segment BANKED_CODE
   342 bytes in segment BANK_RELAYS
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    48 bytes in segment XDATA_Z
 
 4 844 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
    59 bytes of XDATA memory

Errors: none
Warnings: none
